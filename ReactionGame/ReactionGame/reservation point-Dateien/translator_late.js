function onPageSizeChanged(e,t){var n=$(e),a=parseInt(n.val());isNaN(a)||a<1?n.css("color","red"):location.href=t+"&page="+a}function DLPriceCalculator(e){var t=this;Object.defineProperty(t,"characterLimit",{get:function(){return this._characterLimit},set:function(e){this._characterLimit=Math.min(Math.max(e,this.productCharacterLimit),1e12-1)}}),Object.defineProperty(t,"words",{get:function(){return Math.floor(this._characterLimit/7)},set:function(e){this.characterLimit=7*e}}),Object.defineProperty(t,"additionalCharacters",{get:function(){return Math.max(0,this.characterLimit-this.productCharacterLimit)},set:function(e){this.characterLimit=this.productCharacterLimit+Math.max(0,kDeepL.parseLimit(e))}}),Object.defineProperty(t,"additionalPrice",{get:function(){return t.productPrice*t.additionalCharacters/t.productCharacterLimit},set:function(e){t.additionalCharacters=Math.max(0,kDeepL.parsePrice(e)*t.productCharacterLimit/t.productPrice)}}),Object.defineProperty(t,"price",{get:function(){return t.productPrice+t.additionalPrice},set:function(e){t.additionalPrice=Math.min(e,2e6-.01)-t.productPrice}}),void 0!==e?(this.productCharacterLimit=kDeepL.parseLimit(e.productCharacterLimit),this.characterLimit=Math.max(kDeepL.parseLimit(e.characterLimit),this.productCharacterLimit),this.productPrice=kDeepL.parsePrice(e.price),this.currency=e.currency):(this.productCharacterLimit=null,this.characterLimit=null,this.productPrice=null,this.currency=null),this.copyData=function(e){e.productCharacterLimit=this.productCharacterLimit,e.characterLimit=this.characterLimit,e.productPrice=this.productPrice,e.currency=this.currency}}!function(e){e.dbg_pendingWhenAvailables={};var t=0;e.whenAvailable=function(n,a){function i(t){s?l.push(t):(e.__verbose()&&console.log("[M] whenAvailable",c,"-> ok."),t.apply(void 0,o))}var r=++t,o=[],s=0,l=[],c="string"==typeof n?[n]:n;return c.forEach(function(t,n){var a=e.__getModuleWrapper(t);if(a.hasOwnProperty("value"))o.push(a.value);else if(++s,o.push(void 0),a.onReady.push(function(t){if(o[n]=t,0==--s)for(e.__verbose()&&console.log("[M] $"+r+" ... whenAvailable",c,"-> ok."),delete e.dbg_pendingWhenAvailables[r];l.length;)l.shift().apply(void 0,o)}),(t.startsWith("/")||t.startsWith("./"))&&!a.isRequested){a.isRequested=!0;var i=t+".js",u=new XMLHttpRequest;u.onreadystatechange=function(){if(u.readyState===XMLHttpRequest.DONE)if(200===u.status){(0,eval)("(function(){ var __moduleId='"+t+"';function define(){var p=[__moduleId];for(var i=0;i<arguments.length;++i) p.push(arguments[i]);M.define.apply(M, p);} "+u.responseText+"\n})();")}else console.warn("[M] Could not load module ",t),window._rq=u},u.open("GET",i,!0),u.send(null)}}),s&&(e.__verbose()&&console.log("[M] whenAvailable",c,"-> waiting...","$"+r),e.dbg_pendingWhenAvailables[r]=l),a&&i(a),{then:i}},e.require=function(t,n){var a=[];return("string"==typeof t?[t]:t).forEach(function(t){var n=e.__getModuleWrapper(t);if(!n.hasOwnProperty("value"))throw new Error("[M] Required module '"+t+"' is not defined.");a.push(n.value)}),n&&n.apply(void 0,a),"string"==typeof t?a[0]:a},e.requireAsync=function(t,n,a){var i,r,o=e.whenAvailable(t);return o.then(function(){i=!0,r&&clearTimeout(r)}),n&&o.then(n),i||(r=setTimeout(function(){var n={};throw t.forEach(function(t){n[t]=void 0!==e.get(t)}),new Error("[M] Could not fulfil requirements after timeout: "+JSON.stringify(n))},a||5e3)),o},e.define=function(t,n,a){e.__verbose()&&console.log("M.define",arguments),e.requireAsync(n).then(function(){e.register(t,a.apply(void 0,arguments))})}}(window.M),M.register("M",M),window.jQuery&&M.register("$",jQuery),M.define("queryVars",[],function(){return function(e){for(var t=new Object(null),n=0;n<e.length;++n){var a=e[n].split("=",2);t[a[0]]=1==a.length?"":a[1]}return t}(window.location.search.substr(1).split("&"))});var U=function(){function e(t){var n=!1,a=Date.now();if(t.runningRequests.splice(0).forEach(function(e){e.finished||(t.runningRequests.push(e),e.blockingUntil>a&&(n|=!0))}),!n&&t.waitingRequest){var i=t.waitingRequest;t.waitingRequest=!1,i.blockingUntil=Date.now()+i.blockingDuration,t.runningRequests.push(i),i.command().then(function(){i.finished&&console.warn("SHOULD NOT HAPPEN"),i.finished=!0;try{i.id>t.maxResultId?(t.maxResultId=i.id,i.success.apply(this,arguments)):i.failure("Outdated result")}finally{e(t)}},function(){i.finished=!0,setTimeout(function(){e(t)}),i.failure.apply(this,arguments)})}}function t(a,i,r){var o=n[a];return void 0===o&&(n[a]=o={requestId:0,maxResultId:-10,waitingRequest:void 0,runningRequests:[]}),new Promise(function(n,a){var s={id:o.requestId++,command:i,blockingUntil:void 0,blockingDuration:r||1e3,success:n,failure:a,finished:!1},l=o.waitingRequest;o.waitingRequest=s,l&&(l.finished=!0,l.failure(t.FAILURE_REASON__CANCELED)),e(o)})}var n=new Object(null);t.FAILURE_REASON__CANCELED=new Object,t.isEmpty=function(t){var a=n[t];return!a||(e(a),!a.waitingRequest&&!runningRequests.length)},t.delayIfEmpty=function(e,n){t.isEmpty()&&t(e,function(){return new Promise(function(e,t){setTimeout(e,n)})},n)};var a=new Object(null),i=!1,r={setVerbose:function(e){i=e},createCallOnce:function(){var e=[],t=function(){for(;e.length>0;)e.shift().apply(null,arguments);return t};return t.push=function(n){return e.push(n),t},t},createMultiProcedure:function(){var e=[],t=function(){for(var t=e.splice(0),n=0;n<t.length;++n)"REMOVE"!=t[n].apply(null,arguments)&&e.push(t[n])};return t.push=function(t){e.push(t)},t._procedures=e,t},createValueWrapper:function(e){var t=r.createMultiProcedure(),n=e,a=function(){if(0==arguments.length)return n;var e=n;(n=arguments[0])!==e&&t(n)};return a.onValueChanged=t,a},createValueWrappers:function(e,t){if(Array.isArray(e)){var n=[];return e.forEach(function(e){n.push(r.createValueWrapper(e))}),n}var a=new Object(null);for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];t&&o&&"object"==typeof o||Array.isArray(o)?a[i]=r.createValueWrappers(o):a[i]=o&&"function"==typeof o?o:r.createValueWrapper(o)}return a},createPersistentValueWrapper:function(e,t){var n=e.match(/^(?:([^\.]*)\.)?(.*)$/),i=n[1]||"persistentStorage",o=n[2],s=a[i]||window.localStorage&&(a[i]=JSON.parse(localStorage.getItem(i)||"{}"))||new Object(null),l=r.createValueWrapper(void 0===s[o]?t:s[o]);return l.onValueChanged.push(function(e){s[o]=e,s&&window.localStorage&&window.localStorage.setItem(i,JSON.stringify(s))}),l},notify:function(e,t){if(r.__listenerRegistry){var n=r.__listenerRegistry[e],a=Array.prototype.slice.call(arguments,1);i&&console.log("[Event] Notify '"+e+"' -> "+(n?n._procedures.length:0)+" listeners",{args:a,listeners:n?n._procedures:[]}),n&&n.apply(null,a)}},listenOn:function(e,t){i&&console.log("[Event] Listen on '"+e+"'",{listener:t}),r.__listenerRegistry||(r.__listenerRegistry=new Object(null)),r.__listenerRegistry[e]||(r.__listenerRegistry[e]=r.createMultiProcedure()),r.__listenerRegistry[e].push(t)},callOnce:function(e,t){if(t){if(r.__calledOnce||(r.__calledOnce=new Object(null)),!r.__calledOnce[e])return r.__calledOnce[e]=!0,t()}else if(!e.hasOwnProperty("__calledOnce"))return e.__calledOnce=!0,e()},addCSSNode:function(e,t){if(document.addEventListener){var n=document.createElement("style");n.setAttribute("type","text/css"),t&&n.setAttribute("id",e),n.appendChild(document.createTextNode(t||e)),document.getElementsByTagName("head")[0].appendChild(n)}},urlWithParameter:function(e,t,n){var a=t+"="+encodeURIComponent(n),i=!0,r=e.replace(new RegExp(t+"=[^&]*"),function(e){return i=!1,a});return i?r+(r.indexOf("?")<0?"?":"&")+a:r},scheduleNonConcurrentRequest:t,setTimeout_consolidated:function e(t,n,a){var i=e._timers||(e._timers=new Object(null));return i[t]&&clearTimeout(i[t]),i[t]=setTimeout(function(){i[t]=void 0,n()},a)}};return r}();window.M&&M.register("U",U),M.define("RPC",["$","queryVars"],function(e,t){var n=0,a={REMOTE_ERROR:"REMOTE_ERROR",INVALID_RESPONSE_JSONRPC:"INVALID_RESPONSE_JSONRPC",INVALID_RESPONSE_JSON:"INVALID_RESPONSE_JSON",REQUEST_FAILED:"REQUEST_FAILED"};return{connectTo:function(i){var r=i.url,o=i.method||"GET",s=i.timeout,l=i.username,c=i.password,u=!!i.withCredentials,d=!1,_={getFunction:function(i){return function(_,h){function p(e){console.log("RPC Call: ",r,f,e)}var f=JSON.stringify({jsonrpc:"2.0",method:i,params:void 0===_?[]:_,id:++n});return new Promise(function(n,_){if(!t.trafficlogging||t.trafficlogging!=i&&"1"!=t.trafficlogging||console.log("Starting RPC "+r,f,(new Error).stack),e){var g;if("POST"===o){var m=r;if(h&&h.queryParams)for(var v in h.queryParams)h.queryParams.hasOwnProperty(v)&&(m=U.urlWithParameter(m,v,h.queryParams[v]));g=e.ajax({url:m,data:f,method:"POST",timeout:s,username:l,password:c,contentType:"text/plain",headers:h&&h.headers||{},xhrFields:{withCredentials:u}})}else{var T={rq:f};if(h&&h.queryParams)for(var v in h.queryParams)h.queryParams.hasOwnProperty(v)&&(T[v]=value);g=e.ajax({url:r,data:{rq:f},method:"GET",timeout:s,username:l,password:c,headers:h&&h.headers||{},xhrFields:{withCredentials:u}})}g.then(function(e){try{var t=JSON.parse(e);t.error?(p(e),_({errorType:a.REMOTE_ERROR,code:t.error.code,data:t.error.message})):t.jsonrpc?d?setTimeout(function(){n(t.result)},d):n(t.result):(p(e),_({errorType:a.INVALID_RESPONSE_JSONRPC,code:void 0,data:e}))}catch(t){p(e),window._jsonErrorData=e,_({errorType:a.INVALID_RESPONSE_JSON,code:void 0,data:e})}},function(e){var t={xhr:e,status:e.status,requestText:f,basename:r,responseText:e.responseText};console.warn(t),_({errorType:a.REQUEST_FAILED,code:void 0,data:t})})}})}},setDebugDelay:function(e){return d=e,_}};return _},ErrorTypes:a}}),M.define("PubSub",["U"],function(e){return{create:function(t){var n=new Object(null),a=t;return{listenOn:function(t,a){n[t=""+t]||(n[t]=e.createMultiProcedure()),n[t].push(a)},notify:function(e,t){if(e=""+e,n[e]){var i=n[e],r=Array.prototype.slice.call(arguments,1);a&&console.log("[PubSub] Notify '"+e+"' -> "+(i?i._procedures.length:0)+" listeners",{args:r,listeners:i?i._procedures:[]}),i&&i.apply(null,r)}},_setVerbose:function(e){a=e},_registry:n}}}}),window.dl_documentReady||(window.dl_documentReady=function(e){(window.dl_documentReady._callbacks||(window.dl_documentReady._callbacks=[])).push(e)}),jQuery.fn.extend({dlReset:function(){return this.each(function(){this.reset()})}}),Number.prototype.dlPad=function(e){var t="00000000000000000000"+this;return t.substr(t.length-e)},Number.prototype.dlPrice=function(){return this.toFixed(2)},Number.prototype.dlLimit=function(e){var t=Math.floor(this<0?-this:this);if(0==t)return"0";for(var n="";t>0;){var a=Math.floor(t%1e3);n.length>0&&(n=" "+n),(t=Math.floor(t/1e3))&&(a=a.dlPad(3)),n=a+n}return this<0?"-"+n:n},String.prototype.dlPrice=function(){var e=parseFloat(this);return isNaN(e)?this:e.dlPrice()},String.prototype.dlLimit=function(e){var t=parseInt(this);return isNaN(t)?this:t.dlLimit(e)},Date.prototype.dlDayOffset=function(e){return new Date(this.getTime()+864e5*e)},Date.prototype.dlISODate=function(){return this.toISOString().substring(0,10)};var kDeepLHelpBox=function(){function e(e){var t=this._box.find(".dl_help_box_content"),n=t.html();return void 0!==e&&t.html(e),n}function t(e,t){var n=t||this.direction(),a=this._box.outerWidth(),i=this._box.outerHeight(),r=this._box.offset(),o=e;if(!o){var r=this._element.offset(),s=this._element;switch(n){case"top":o={top:r.top+s.outerHeight(),left:r.left+s.outerWidth()/2};break;case"left":o={top:r.top+s.outerHeight()/2,left:r.left};break;case"right":o={top:r.top+s.outerHeight()/2,left:r.left+s.outerWidth()};break;case"bottom":o={top:r.top,left:r.left+s.outerWidth()/2}}}switch(n){case"top":r.top=o.top,r.left=o.left-a/2;break;case"left":r.top=o.top-i/2,r.left=o.left;break;case"right":r.top=o.top-i/2,r.left=o.left-a;break;case"bottom":r.top=o.top-i,r.left=o.left-a/2}return function(e){e.find(".dl_help_box_top_peak,.dl_help_box_left_peak,.dl_help_box_right_peak,.dl_help_box_bottom_peak").css("display","")}(this._box),this._box.find(".dl_help_box_"+n+"_peak").css("display","block"),this._box.offset(r),this}function n(){return this._box.css("opacity")<.1||"hidden"==this._box.css("visibility")}function a(e,t,n,a){if(this.isHidden()&&!this.isDisabled()){var i=this._box;this._timer=setTimeout(function(){this._timer=null,a&&!a()||(i.css("visibility","visible"),i.animate({opacity:1},e||0,"swing",n))},t)}return this}function i(e,t,n){var a=this._box;return this._timer=setTimeout(function(){this._timer=null,a.animate({opacity:0},e||0,"swing",function(){a.css("visibility",""),n&&n()})},t||0),this}function r(){var e="top";return this._box.find("> div:visible").each(function(){var t=this.className.match(c);t&&t.length>1&&(e=t[1])}),e}function o(){return 0==this._box.parent().length}function s(e){e!=this.isDisabled()&&(e?this._box.remove():$("body").append(this._box))}function l(e){var t=this._box.width();return e&&this._box.width(e),t}var c=/dl_(top|left|right|bottom)_peak/;return{apply:function(e){var t=this;(e?$(e):$(".dl_help")).each(function(){var e=t.create(this);$(this).click(function(n){return n.preventDefault(),t.close(),e.isHidden()?(e.position(),e.show()):e.hide(),!1})})},close:function(){$("div.dl_help_box").each(function(){$(this).data().hide()})},create:function(c){var u,d=$(c),_=$("<div class='dl_help_box'><div class='dl_help_box_top_peak'></div><div class='dl_help_box_left_peak'></div><div class='dl_help_box_background'></div><div class='dl_help_box_right_peak'></div><div class='dl_help_box_bottom_peak'></div></div>"),h=$("<div class='dl_help_box_content'></div>"),p=d.children().clone();return h.html(p),_.append(h),$("body").append(_),u={_box:_,_element:d,content:e,direction:r,position:t,isHidden:n,show:a,hide:i,isDisabled:o,disable:s,width:l},_.data(u),u},install:function(e){var t=this;this.apply(e),$("body").click(function(){t.close()})}}}(),kDeepLBackend=new function(){var e=this;this.clearErrors=function(e){$(e);e.find("#dl_errors, .dl_errors").hide().children().remove(),e.find(".dl_error").removeClass("dl_error")},this.addMessages=function(e,t){if(t){var n=$(e);t.forEach(function(e){n.append($("<li />").html(e))})}},this.applyErrors=function(t,n){var a=$(t),i=n.fieldErrors,r=a.find("#dl_errors, .dl_errors");e.addMessages(r,n.errors);for(var o in i)a.find("#dl_label_"+o).addClass("dl_error"),e.addMessages(r,i[o]);return r.children().length>0&&r.show(),r.children().length},this.request=function(e,t){return new function(){var n=this;this.dialog=$(e),this.successHandler=function(){},this.alwaysHandler=function(){},this.validationErrorHandler=function(){},this.errorHandler=function(e,t){console.error("Request failed: status = "+e.statusText+"\ndata = \n"+(void 0!==e.responseText?e.responseText.substr(0,1024):"undefined"))},this.success=function(e){return n.successHandler="string"==typeof e?function(){location.href=e}:e,n},this.always=function(e){return n.alwaysHandler=e,n},this.validationError=function(e){return n.validationErrorHandler=e,n},this.error=function(e){return n.errorHandler=e,n},this.send=function(e,a){var i=function(e,a,i){try{var r=$.parseJSON(e);0==kDeepLBackend.applyErrors(n.dialog,r)?n.successHandler(r):n.validationErrorHandler(r)}catch(a){t?kDeepLBackend.applyErrors(n.dialog,{errors:["JSON Error: exception = "+a+"\nresponse = \n"+e]}):console.error("JSON Error: exception = "+a+"\nresponse = \n"+e)}};return a?$.post(e,a,i,"text").always(function(){n.alwaysHandler()}).fail(function(e,t){n.errorHandler(e,t)}):$.get(e,i,"text").always(function(){n.alwaysHandler()}).fail(function(e,t){n.errorHandler(e,t)}),n}}},this.send=function(t,n,a,i){e.request(t).success(i).send(n,a)},this.parameters=function(e,t){var n={};return $(e).find("input, select, textarea").each(function(){var e=$(this),a=e.attr("name");if(a){var i=e.val();"checkbox"!=this.type||e.is(":checked")?"radio"!=this.type||e.is(":checked")||(i=null):i=t,null!=i&&(a.endsWith("[]")?a in n?n[a].push(i):n[a]=[i]:n[a]=i)}}),n}},kDeepL=new function(){function e(){r.isLoggedIn()?($("#dl_menu_login").hide(),$("#dl_menu_account").show()):($("#dl_menu_login").show(),$("#dl_menu_account").hide())}function t(){return new Promise(function(e,t){void 0===u&&o.isLoggedIn()?M.requireAsync(["RPC"],function(n){n.connectTo({url:"/PHP/backend/account.php?request_type=jsonrpc&il="+o.getDocumentLanguage(),method:"POST",withCredentials:!0}).getFunction("getUserEmail")().then(function(t){u=t.email,e(u)},t)}):e(u)})}function n(e){var t=$(e||".dl_open").closest(".dl_dropdown_dialog");t.find("form").dlReset(),$(".dl_menu_items").removeClass("dl_menu_items--open"),$(".dl_menu_items a.dl_open").removeClass("dl_open"),t.removeClass("dl_open_2"),setTimeout(function(){t.hasClass("dl_open_2")||t.removeClass("dl_open")},500),kDeepLBackend.clearErrors(t)}function a(e,t){n();var a=$("#dl_send_password_menu");a.data("dl_initialized")||a.find(".dl_send_password_menu__back_to_login_button").on("click",function(e){o.openLoginMenu(a.data("dl_sourceMenuEntry"))}),kDeepLBackend.clearErrors(a),r.openDialog(e,a),a.find("input").val(t||"").focus()}function i(){$("body").removeClass("dl_popup_opened")}var r=this,o=this,s=window.navigator.userLanguage||window.navigator.language,l=s.toUpperCase(),c=navigator.userAgent||"";l&&l.indexOf("-")>=0?this.language=l.substr(0,l.indexOf("-")):this.language=l,this.isTouchDevice="ontouchstart"in window||!!navigator.msMaxTouchPoints,this.locale=s.replace("-","_").toUpperCase(),this.isMobilePhone=void 0!==window.matchMedia&&window.matchMedia("only screen and (max-device-width : 650px)").matches,this.isIPhone=c.match(/[\(\/](iPhone|iPod)/),this.isIPad=c.match(/[\(\/](iPad)/),this.isAndroid=c.indexOf("Android")>=0,this.isMobileLayout=this.isMobilePhone,window.dl_documentReady(function(){var e=document.body.className;e&&(e+=" "),e+=this.isTouchDevice?"touch-device":"mouse-device",this.isIPhone?e+=" iphone ios":this.isIPad?e+=" ipad ios":this.isAndroid&&(e+=" android"),document.body.className=e}),this.initBody=function(){if(window.dl_documentReady){var e=window.dl_documentReady._callbacks;for(window.dl_documentReady=function(e){e()};e&&e.length;)try{e.shift()()}catch(e){console.error(e)}}},this.dataUseProhibited=function(){return!!$.cookie("data-use-prohibited")},this.setDataUseProhibited=function(e){e?$.cookie("data-use-prohibited","true",{expires:7305}):$.removeCookie("data-use-prohibited")},this.localizationLanguages=["EN","DE","FR","ES","IT","NL","PL"],this.getDocumentLanguage=function(){return document.documentElement.getAttribute("lang").toUpperCase()},this.isLoggedIn=function(){return!!$.cookie("dl_session")},this.getSessionToken=function(){return $.cookie("dl_session")},this.waiting=function(e,t){return new function(){var n=$(e),a=$("#dl_waiting").clone(),i=t||1;this.show=function(){return n.append(a),a.css("opacity",i),a.css("display","block"),this},this.hide=function(){return a.remove(),this}}};var u;o.requestUserEmail=t,this.openDialog=function(e,t){var a=$(e),i=$(t);if(i.css("display",""),!i.hasClass("dl_open")){var r=a.offset(),o=$(window).width();return n(),a.closest(".dl_menu_items").addClass("dl_menu_items--open"),i.addClass("dl_open"),setTimeout(function(){i.addClass("dl_open_2")}),i.data("dl_sourceMenuEntry",e),r.left<.5*o?r.left-=1:r.left=Math.floor(r.left+a.outerWidth()-i.outerWidth()),r.top+=a.outerHeight(),i.find("form").dlReset(),a.addClass("dl_open"),i.css(r),!1}n()},this.closeDialog=n,o.openAccountMenu=function(e){o.openDialog(e,"#dl_account_menu");var n=$("#dl_account_menu");n.data("_initialized")||(n.data("_initialized",!0),t().then(function(e){n.find("[dl-attr='email']").text(e)}))},this.setAccount=function(t){t&&"token"in t?r.account=t:($.cookie("dl_session",null),delete r.account),e()},this.getAccount=function(){return"account"in r?r.account:null},this.toggleLoginMenu=function(e,t){console.log("toggle");var n=$("#dl_login_menu");n.hasClass("dl_open")?r.closeDialog(n):r.openLoginMenu(e,t?function(){location.href=t}:void 0)},this.openLoginMenu=function(e,t){function n(){i.hasClass("dl_login_menu--activeRequest")||(s.html(""),i.addClass("dl_login_menu--activeRequest"),M.requireAsync(["dlLoginController"],function(e){e.login(o.val(),c.val(),u.val()).then(function(e){console.log("Success"),l(e)},function(e){i.removeClass("dl_login_menu--activeRequest"),s.html(e.message)})}))}var i=$("#dl_login_menu"),o=i.find("[name='username']"),s=i.find(".dl_login_menu__errors").html(""),l=t||function(e){"target"in e?location.href=e.target:location.reload()};if(!i.data("dl_initialized")){i.data("dl_initialized",!0);var c=i.find("[name='password']"),u=i.find("[name='keepLogin']"),d=i.find(".dl_login_menu__login_button");i.removeClass("dl_login_menu--activeRequest"),i.on("keydown",function(e){27===e.keyCode&&r.closeDialog(i)}),i.find("input").on("keydown",function(e){27===e.keyCode&&r.closeDialog(i)}),d.on("click",function(){n()}),o.on("keypress",function(e){13===e.keyCode&&n()}),c.on("keypress",function(e){13===e.keyCode&&n()}),i.find(".dl_login_menu__forgot_password_button").on("click",function(e){a(i.data("dl_sourceMenuEntry"),o.val())})}setTimeout(function(){o.focus()}),i.hasClass("dl_open")||r.openDialog(e,i)},this.openSuccessMessage=function(e,t,n){var a=$("#dl_success");kDeepLBackend.clearErrors(a),a.find("h3").html(t),a.find("p").html(n),r.openDialog(e,a)},this.openSendPasswordLink=a,this.sendPasswordLink=function(e){var t=$(e).closest("form"),n={action:"SendPasswordLink",email:t.find("input[name=pwd_reset__username]").val()};kDeepLBackend.clearErrors(t),kDeepLBackend.send(t,"/PHP/backend/account.php?il="+o.getDocumentLanguage(),n,function(e){"message"in e&&"title"in e.message&&"text"in e.message?r.openSuccessMessage("#dl_menu_login",e.message.title,e.message.text):kDeepLBackend.applyErrors(t,e.errors)})},this.logout=function(e,t){$.post("/PHP/backend/account.php",{action:"Logout"}).always(function(){e&&r.closeDialog(e),$.cookie("dl_session",null,{domain:".deepl.com"}),location.href=t||"/index.html"})},this.refresh=function(e){var t=Array.prototype.slice.call(arguments,1);return new Promise(function(n,a){var i=r.waiting("body",.7);i.show(),$.post("/PHP/backend/account.php",{action:"Refresh","types[]":t},function(t){if(console.log("inData",t),!jQuery.isPlainObject(t))return console.log("not a plain object"),void a("internal error");o.data=t,"account"in t&&"token"in t.account?(r.setAccount(t.account),"messageCount"in t&&t.messageCount>0?$("#dl_messages_menu").addClass("dl_menu_note"):$("#dl_messages_menu").removeClass("dl_menu_note")):r.setAccount(null),e&&e(t),n(t)}).fail(function(e){a(e)}).always(function(){i.hide()})})},this.parseLimit=function(e){return"number"==typeof e?e:Math.round(parseFloat(e.replace(/\s+/g,"")))},this.parsePrice=function(e){return parseFloat(e)},this.parseURL=function(e){var t=document.createElement("a"),n={},a={};return t.href=e,n.protocol=t.protocol,n.host=t.hostname,n.port=""==t.port?null:parseInt(t.port),n.path=t.pathname,t.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){a[t]=n}),n.parameters=a,n},this.formatPrice=function(e){if(function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(e)){var t=parseFloat(e).toFixed(2);return"EN"!=this.getDocumentLanguage()&&(t=t.replace(".",",")),t}return""},this.formatPriceWithCurrency=function(e){return"EN"!=this.getDocumentLanguage()?this.formatPrice(e)+"&#x202f;€":"€"+this.formatPrice(e)},this.createTranslatorURL=function(e){return"https://api.deepl.com/v1/translate?"+$.param(e)},this.checkTranslatorURL=function(e,t){var n=this.parseURL(e),a={},i=[],r=[];"https:"!=n.protocol&&(a.protocol=n.protocol),"api.deepl.com"!=n.host&&(a.host=n.host),null!==n.port&&(a.port=n.port),"/v1/translate"!=n.path&&(a.path=n.path);for(var o in n.parameters)o in this.checkTranslatorURL.parameters||r.push(o);r.length>0&&(a.unknownParameters=r.join(", "));for(var o in this.checkTranslatorURL.parameters)!this.checkTranslatorURL.parameters[o]||o in n.parameters||i.push(o);return i.length>0&&(a.missingParameters=i.join(", ")),"source_lang"in n.parameters&&this.checkTranslatorURL.languages.indexOf(n.parameters.source_lang)<0&&(a.source_lang=n.parameters.source_lang),"target_lang"in n.parameters&&this.checkTranslatorURL.languages.indexOf(n.parameters.target_lang)<0&&(a.target_lang=n.parameters.target_lang),"tag_handling"in n.parameters&&this.checkTranslatorURL.languages.indexOf(n.parameters.tag_handling)<0&&(a.tag_handling=n.parameters.tag_handling),t&&"auth_key"in n.parameters&&n.parameters.auth_key!=t&&(a.auth_key=n.parameters.auth_key),a},this.checkTranslatorURL.languages=["DE","EN","ES","FR","IT","NL","PL"],this.checkTranslatorURL.tagHandlers=["xml"],this.checkTranslatorURL.parameters={text:!0,source_lang:!1,target_lang:!0,tag_handling:!1,auth_key:!0},this.addFloatingSubscriptionButton=function(e){function t(){var o=document.documentElement.scrollTop||document.body.scrollTop||0;if(o>e)if(n){var s=document.querySelector(".dl_footer");if(s&&s.getBoundingClientRect){var l=s.getBoundingClientRect().y+r.getBoundingClientRect().height,c=a.getBoundingClientRect().y;r.style.top=c>l?l-c+"px":"0px"}}else n=!0,a.classList.add("dl_pro_floating_subscribe_button--visible");else o<e&&n&&(a.classList.remove("dl_pro_floating_subscribe_button--visible"),n=!1);i||(i=setTimeout(function(){t(),i=!1},100))}var n=!1,a=document.querySelector(".dl_pro_floating_subscribe_button");a||((a=document.createElement("div")).classList.add("dl_pro_floating_subscribe_button"),a.innerHTML="<a href='/pro-registration.html'>"+(window.dl_texts&&dl_texts["pro-home/subscribeNowButton"]||"Subscribe now!")+"</a>",document.body.appendChild(a)),e=e||0;var i,r=a.querySelector("a");document.addEventListener("scroll",t,{passive:!0})},this.scrollTo=function(e){function t(){i+=function(e,t,n){return e<=t?t:e>=n?n:e}(.9*i+.1*a-i,-100,100),document.scrollingElement.scrollTop=i,--n>0&&requestAnimationFrame(t)}var n=60,a=$(e).offset().top-50,i=document.scrollingElement.scrollTop;t()},window.dl_documentReady(function(){e(),$("body").click(function(e){0==$(e.target).closest(".dl_open, .dl_opener").length&&n()}),$(window).resize(function(e){})}),this.createValueWrapper=function(e){var t=e,n=function(e){if(!arguments.length)return t;if(e!==t){t=e;var a=n.onValueChanged;a.splice(0).forEach(function(e){"REMOVE"===e(t)||a.push(e)})}};return n.onValueChanged=[],n},this.initializePopup=function(){$(".dl_popup_close").click(function(){i()}),window.onclick=function(e){e.target==$(".dl_popup")[0]&&i()}},this.closePopup=i,this.openCustomPopup=function(e){return $(".dl_popup_content").removeClass("dl_visible_2"),$(".dl_popup_content").removeClass("dl_visible"),$("#"+e).addClass("dl_visible"),$("#"+e).addClass("dl_visible_2"),$("body").addClass("dl_popup_opened"),!1},this.openPopup=function(e){return $(".dl_popup_content iframe").attr("src",e),$("body").addClass("dl_popup_opened"),!1},this.initializeInlineAnchors=function(){$("a[href^='#']").click(function(){event.preventDefault(),$("html,body").animate({scrollTop:$("a[name='"+$(this).attr("href").substring(1)+"']").offset().top},500)})},this.initializePricingPopup=function(){$("#dl_pro_pricing_article_popup_container, .dl_pro_pricing_popup_close").click(function(){$("body").removeClass("dl_pricing_popup_opened")}),$(".openPricingPopupButton").click(function(){$("#dl_pro_pricing_article_popup").css("top",document.scrollingElement?document.scrollingElement.scrollTop+30:document.documentElement.scrollTop+30),$("body").addClass("dl_pricing_popup_opened"),event.preventDefault()})}},kDeepLCellFormatter=new function(){this.substitute=function(e,t){for(var n=e,a=(n.length,0),i=n.indexOf("${"),r="";i>=0;){var o=n.indexOf("}",i+2);if(o>=0){var s=n.substring(i+2,o).split(","),l=s in t?t[s]:s;r+=n.substring(a,i),l&&(r+=l),a=o+1,i=n.indexOf("${",a)}else i=-1}return r+=n.substring(a)}};M.define("dlLoginController",["RPC","$","kDeepL","U"],function(e,t,n,a){var i=e.connectTo({url:"/PHP/backend/account.php?request_type=jsonrpc&il="+n.getDocumentLanguage(),method:"POST",withCredentials:!0}).getFunction("login");return{login:function(e,t,n){return new Promise(function(a,r){var o=[];if((e=e.trim()).length||o.push(dl_texts["messages/fieldError.login_emailRequired"]),t.length?t.length<8&&o.push(dl_texts["messages/fieldError.passwordTooShort"]):o.push(dl_texts["messages/fieldError.login_passwordRequired"]),o.length){var s={message:o.join("<br/>\n")};console.warn(s),r(s)}else i({email:e,password:t,keepLogin:n}).then(a,function(e){setTimeout(function(){r(t)},1e3),console.warn(e);var t={message:"Login not possible at the moment. Please try again later."};if(21==e.code){var n=JSON.parse(e.data),a=[];for(var i in n)n.hasOwnProperty(i)&&a.push(n[i]);t.message=a.join("<br/>\n")}else if(20==e.code){var o=JSON.parse(e.data);t.message=o[0]}})})}}}),window.M&&M.get("kDeepL")||(window.M?M.register("kDeepL",kDeepL):dl_documentReady(function(){window.M&&M.register("kDeepL",kDeepL)})),window.$&&window.$(function(){console.log("Welcome to DeepL.com!"),kDeepL.initBody()}),$("#dl_translator").length&&M.require(["$","U","queryVars"],function($,U,queryVars){function langName(e){return"EN"==e?"english":"DE"==e?"german":"FR"==e?"french":"ES"==e?"spanish":"IT"==e?"italian":"NL"==e?"dutch":"PL"==e?"polish":"RU"==e?"russian":""}function wordBegin(e,t){for(;t>0&&-1==ch_nonword.indexOf(e[t-1]);)t--;return t}function spaceAfter(e,t){for(;t<e.length&&-1==ch_nonword.indexOf(e[t]);)t++;return t}function wordAfter(e,t){for(t=spaceAfter(e,t);t<e.length&&-1!=ch_nonword.indexOf(e[t]);)t++;return t}function DictQuery(e,t){var n=$(t);this.eventkind=e,this.forleftside=n.is(".lmt__source_textarea"),this.$textfield=n,this.kind="",this.langCode=this.forleftside?ui.sourceLang:ui.targetLang,this.targetLangCode=this.forleftside?ui.targetLang:ui.sourceLang,this.lang=langName(this.langCode),logging&&log(TAG,"DictQuery: langCode="+this.langCode+", lang="+this.lang+", targetLang="+this.targetLangCode+", kind="+this.kind+", forleftside="+this.forleftside+", eventkind="+this.eventkind);var a,i,r=n.get(0);if("selectionStart"in r)a=r.selectionStart,i=r.selectionEnd;else if("selection"in document){r.focus();var o=document.selection.createRange(),s=document.selection.createRange().text.length;o.moveStart("character",-r.value.length),a=o.text.length-s,i=o.text.length}var l=n.val();if(this.fulltext=l.trim(),this.fieldStatus=this.langCode+"::"+this.targetLangCode+"::"+this.fulltext,lastFieldStatus==this.fieldStatus&&("keyup"==e||"paste"==e||"change"==e)&&a==i)return logging&&log(TAG,"no change. return"),void(this.nochange=!0);if(lastFieldStatus=this.fieldStatus,this.query="",this.key=function(){return this.langCode+":"+this.targetLangCode+":"+this.query},"auto"!=this.langCode&&""!=this.targetLangCode){if(a!=i)this.query=l.substr(a,i-a).trim(),this.query>=60?(this.query="",logging&&log(TAG,"Dict query: query for selection ignored because selected text is too long.")):(this.kind="select",logging&&log(TAG,"Dict query: query for selection: "+this.query));else{var c=a,u=0==l.substr(c).trim().length;if(this.forleftside&&(u||"click"!=e))l=l.trim(),this.kind="full",l.length<60&&(this.query=l,logging&&log(TAG,"Dict query: full query because cursor at end and not too long: "+this.query));else if(u)logging&&log(TAG,"Dict query: ignoring click at end of text");else if(this.forleftside||"click"==e){var d=wordBegin(l,c),_=spaceAfter(l,c);if(d==c&&-1!=ch_nonword.indexOf(l[c]))logging&&log(TAG,"Dict query: no word at position "+c);else{var h="DE"==this.langCode?50:25,p=d-h>0?p=wordAfter(l,d-h):0,f=_+h<l.length?l.length-wordBegin(l,_+h):0;this.query=(l.substr(p,d-p)+"###"+l.substr(d,l.length-d-f)).trim(),this.kind="context",logging&&log(TAG,"Dict query: word of length "+(_-c)+" found "+(c-d)+" characters before cursor position "+c+". Stripped "+p+" at the front and "+f+" at the back. Query: "+this.query)}}}}}function displayDict(e,t){var n=$("#lmt__dict");n.empty().append(e),0==n.find(".lemma").length&&""!=t.fulltext&&langPairsWithDict.indexOf(t.langCode+t.targetLangCode)>=0&&("full"==t.kind?n.append($(".lmt__dict__click_on_word_hint").clone()):""!=t.kind&&n.append($(".lmt__dict__word_not_in_dictionary_message").clone()))}function tooManyRequests(e,t){function n(){countdown_n>0?(console.log("countDownSeconds "+countdown_n),$("#lmt__dict").find(".seconds").text(""+countdown_n),countdown_n--,timerTooManyRequests=setTimeout(n,1020)):(console.log("showing Dict"),showDictFor(t,!0))}timerTooManyRequests&&(console.log("Clearing tooManyRequests timeout."),clearTimeout(timerId),timerTooManyRequests=!1);var a=("5seconds"==e?"<div class='lmt__busy_indicator lmt__busy_indicator--active'></div>":"")+$("#lmt__dict_message__tooManyRequests_"+e).html();$("#lmt__dict").empty().append(a),"5seconds"==e&&((countdown_n<1||countdown_n>4)&&(countdown_n=4),n()),"minute"==e&&((countdown_n<1||countdown_n>40)&&(countdown_n=40),n())}function every5Seconds(){dictQueryCounterThis5Seconds=0,setTimeout(every5Seconds,5e3)}function everyMinute(){dictQueryCounterThisMinute=0,setTimeout(everyMinute,6e4),status==STATUS_ERRORS&&(new Date).getTime()-lastStatusDropTime>6e4&&(console.log("Reset STATUS to normal."),STATUS=STATUS_NORMAL),status==STATUS_STRESS&&(new Date).getTime()-lastStatusDropTime>3e5&&(console.log("Reset STATUS to normal."),STATUS=STATUS_NORMAL)}function everyHour(){dictQueryCounterThisHour=0,setTimeout(everyHour,36e5)}function parseResponse(e,t){var n=$(t);$("#lmt__dict");(n=n.find(".isMainTerm:not(.spell_suggestion)[data-source-lang='"+e.langCode+"'], .isForeignTerm:not(.spell_suggestion)[data-source-lang='"+e.langCode+"']")).find(".inexact, .line.inflectioninfo, .audio, .copyrightLineOuter, .spell_suggestion").remove(),n.find("a").removeAttr("href"),n.find("h2").append("<div class='sourceHint'>Linguee Dictionary</div>");var a=n.find("h2.lemma_desc");return a.addClass("source"),"EN"==e.langCode&&e.fulltext.startsWith("to ")&&n.find(".lemma").filter(function(e){return attr=$(this).attr("wt"),attr&&attr.startsWith("1")&&3==attr.length}).remove(),(justIgnored=0==a.length)?$():n}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function showDictFor(query,force){function checkResponseForConfig(data){try{if(data.startsWith("CONFIG=")){var newLineIdx=data.indexOf("\n"),configStr=data.substr(7,-1==newLineIdx?data.length-7:newLineIdx-7);log(TAG,"Resetting CONFIG to",configStr),CONFIG=eval(configStr),log(TAG,"Resetted CONFIG to",CONFIG),data=data.substr(newLineIdx+1)}}catch(e){console.warn(TAG,"ERROR while checking response for CONFIG= part.")}return data}if(logging&&log(TAG,"showDictFor: query="+query.query+", langCode="+query.langCode+",targetLangCode="+query.targetLangCode),!query.nochange||force){var $dict=$("#lmt__dict"),sourceLangPath=langName(query.langCode),targetLangPath=langName(query.targetLangCode),queryKey=query.key();if(latestQueryKey!=queryKey||force&&""!=latestQueryKey){if(logging&&log(TAG,"showDictFor: queryKey changed from "+latestQueryKey+" to "+queryKey),timerId&&!force&&(logging&&log(TAG,"Clearing timer."),clearTimeout(timerId),timerId=!1),timerTooManyRequests&&(clearTimeout(timerTooManyRequests),timerTooManyRequests=!1),latestQueryKey=queryKey,latestQueryWasForLeftSize=query.forleftside,query.query.length<2||void 0===query.query||-1===langPairsWithDict.indexOf(query.langCode+query.targetLangCode))return logging&&log(TAG,"showDictFor: empty query or lang pair without dictionary."),""!=latestQueryKey&&displayDict("",query),void(latestQueryKey=queryKey);if(logging&&log(TAG,"showDictFor: sourceLangPath="+sourceLangPath+", targetLangPath="+targetLangPath),""!=sourceLangPath&&""!=targetLangPath){if(queryKey in dictCache){logging&&log(TAG,"Displaying cached dictionary result for "+queryKey+".");var queryKeyIdx=cachedKeys.indexOf(queryKey);return queryKeyIdx>=0&&(cachedKeys.splice(queryKeyIdx,1),cachedKeys.push(queryKey)),timerId=setTimeout(function(){if(latestQueryKey==queryKey){var e=dictCache[queryKey][0],t=dictCache[queryKey][1];$content=parseResponse(e,t),logging&&log(TAG,"Displaying cached dict content: ",$content,"query: ",e),displayDict($content,e)}},200),void dictResultFromCacheCounter++}if(queryKey in dictCacheEmpty)return logging&&log(TAG,"Displaying cached empty dictionary result for "+queryKey+"."),displayDict($(),query),void dictResultFromCacheCounter++;var delay=justIgnored?CONFIG[STATUS][CONFIG_DELAY_AFTER_EMPTY]:CONFIG[STATUS][CONFIG_DELAY_NORMAL];logging&&log(TAG,"Delaying dictionary lookup by "+delay),timerId=setTimeout(function(){logging&&log(TAG,"Calling scheduleNonConcurrentRequest"),U.scheduleNonConcurrentRequest("dictQuery",function(){return logging&&log(TAG,"Inside scheduleNonConcurrentRequest"),new Promise(function(e,t){return logging&&log(TAG,'Request started for "'+query.query+'" on '+sourceLangPath+"-"+targetLangPath),trafficlogging&&log(TAG,"Dict-Query "+dictQueryCounter+": "+queryKey),dictQueryCounterThis5Seconds>CONFIG[STATUS][CONFIG_LIMIT_5SECS]||queryVars.dictLimit5sec?(tooManyRequests("5seconds",query),void t()):dictQueryCounterThisMinute>CONFIG[STATUS][CONFIG_LIMIT_MINUTE]||queryVars.dictLimitMinute?(tooManyRequests("minute",query),void t()):dictQueryCounterThisHour>CONFIG[STATUS][CONFIG_LIMIT_HOUR]||queryVars.dictLimitHour?(tooManyRequests("hour",query),void t()):(dictQueryCounter++,dictQueryCounterThis5Seconds++,dictQueryCounterThisMinute++,dictQueryCounterThisHour++,void(ajaxReqest=$.ajax({data:{ajax:1,query:query.query.trim(),source:query.lang,onlyDictEntries:1,translator:"dnsof7h3k2lgh3gda",delay:delay,jsStatus:STATUS,kind:query.kind,eventkind:query.eventkind,forleftside:query.forleftside},type:"GET",url:dictServer+"/"+sourceLangPath+"-"+targetLangPath+"/search",timeout:2e4,dataType:"html",success:function(t){t=checkResponseForConfig(t),e(t)},error:function(e,n,a){console.warn(e,n);var i=e.responseText;e.status==RESPONSE_CODE_STRESS?(console.log(TAG,"Setting STATUS to stress. data="+i),STATUS=STATUS_STRESS,lastStatusDropTime=(new Date).getTime(),i=checkResponseForConfig(i)):(console.log(TAG,"Setting STATUS to error."),STATUS=STATUS_ERRORS,lastStatusDropTime=(new Date).getTime()),justIgnored=!0,ajaxReqest.abort(),t()}})))})},25e3).then(function(e){if(dictResultCounter++,$content=parseResponse(query,e),$content.length>0)cachedKeys.length>=100&&(delete dictCache[cachedKeys[0]],cachedKeys.shift()),dictCache[queryKey]=[query,e],cachedKeys.push(queryKey),logging&&log(TAG,"Cached dict result for "+queryKey+". Stored keys: "+cachedKeys.length),logging2&&log(TAG,"Cache: "+Object.keys(dictCache).length+" 1:["+cachedKeys+"] 2:["+Object.keys(dictCache)+"]");else{var t=Object.keys(dictCacheEmpty).length;t>=1e3&&delete dictCacheEmpty[getRandomInt(0,t-1)],dictCacheEmpty[queryKey]=!0,logging&&log(TAG,"Cached empty dict result for "+queryKey+". Stored keys without dict entries: "+Object.keys(dictCacheEmpty).length)}latestQueryKey==queryKey?(setTimeout(function(){logging&&log(TAG,"Displaying loaded dict content: ",$content,"query: ",query),displayDict($content,query)},0),dictResultDisplayedCounter++):(dictResultIgnoredCounter++,justIgnored=!0,logging&&log(TAG,"Ignored received dictionary content (only cached, but not displaying)."))},function(){})},delay)}else logging&&log(TAG,"Returning. (sourceLangPath or targetLangPath is empty)")}}}function logCounters(){var e="Stats: queries="+dictQueryCounter+"(this5Seconds="+dictQueryCounterThis5Seconds+", thisMinute="+dictQueryCounterThisMinute+", thisHour="+dictQueryCounterThisHour+"), received="+dictResultCounter+", ignored="+dictResultIgnoredCounter+", displayedFromResult="+dictResultDisplayedCounter+", displayedFromCache="+dictResultFromCacheCounter+", cached="+cachedKeys.length+", cachedEmpty="+Object.keys(dictCacheEmpty).length;e!=lastStatsMsg&&(log(e),lastStatsMsg=e),setTimeout(logCounters,3e3)}var TAG="[Dict]",log=queryVars.logging?console.log.bind(window.console):function(){},timerId=!1,ajaxReqest=!1,logging=!!queryVars.dictlogging,logging2=2==queryVars.dictlogging,trafficlogging=logging||logging2||!!queryVars.trafficlogging,latestQueryKey="",latestQueryWasForLeftSize=!1,lastFieldStatus="",dictServer=queryVars.dictbackend||"https://dict.deepl.com";log(TAG,"Dict backend: "+dictServer);var STATUS_NORMAL=0,STATUS_ERRORS=1,STATUS_STRESS=2,STATUS=STATUS_NORMAL,CONFIG=[[3,30,900,300,800],[2,30,900,500,1200],[1,12,160,750,3e3]],CONFIG_LIMIT_5SECS=0,CONFIG_LIMIT_MINUTE=1,CONFIG_LIMIT_HOUR=2,CONFIG_DELAY_NORMAL=3,CONFIG_DELAY_AFTER_EMPTY=4;log(TAG,"CONFIG:",CONFIG);for(var RESPONSE_CODE_STRESS=429,LOW_PRIO=-1,HIGH_PRIO=1,lastStatusDropTime=0,ui=LMT_UI,ch_nonword=" ;.!?-+=/%§'`´<>()[]\"\t\n",countdown_n=0,timerTooManyRequests=!1,langPairsWithDict=["DEEN","FREN","ESEN","PTEN","DEFR","DEES","DEPT","FRES","FRPT","ESPT","NLEN","PLEN","ITEN","JAEN","RUEN","ZHEN"],langPairsWithDict2=[],i=0;i<langPairsWithDict.length;i++)langPairsWithDict2.push(langPairsWithDict[i].substr(2,2)+langPairsWithDict[i].substr(0,2));langPairsWithDict=langPairsWithDict.concat(langPairsWithDict2),logging&&log(TAG,"langPairsWithDict:",langPairsWithDict);var dictQueryCounter=0,dictResultCounter=0,dictResultIgnoredCounter=0,dictResultDisplayedCounter=0,dictResultFromCacheCounter=0,justIgnored=!1,dictQueryCounterThis5Seconds=0,dictQueryCounterThisMinute=0,dictQueryCounterThisHour=0;every5Seconds(),everyMinute(),everyHour();var dictCache={},dictCacheEmpty={},cachedKeys=[],$sourceEdit=$(".lmt__source_textarea"),$editFields=$(".lmt__source_textarea, .lmt__target_textarea");$editFields.on("click touchend",function(e){logging&&log(TAG,"new DictQuery on click touchend");var t=this;setTimeout(function(){showDictFor(new DictQuery("click",t))},"touchend"==e.type?100:1)}),$editFields.on("change keyup paste",function(e){logging&&log(TAG,"new DictQuery on change keyup paste. "+e.type),showDictFor(new DictQuery(e.type,this))});var langChanged=!1;if(U.listenOn("LMT/translationReady",function(e,t,n,a){($sourceEdit.is(":focus")||langChanged)&&(logging&&log(TAG,"new DictQuery on translationReady"),showDictFor(new DictQuery("change",$sourceEdit)),langChanged=!1)}),U.listenOn("LMT/translationChanged",function(){""==latestQueryKey||latestQueryWasForLeftSize||(latestQueryKey="",$("#lmt__dict").empty())}),U.listenOn("LMT/langChanged",function(){log(TAG,"langChanged"),langChanged=!0,showDictFor(new DictQuery("langChange",$sourceEdit))}),dl.is_touch_device||$(".lmt__textarea_placeholder_text").hover(function(){$(this).parent().find("textarea").addClass("hover")},function(){$(this).parent().find("textarea").removeClass("hover")}),$(".lmt__textarea_placeholder_text").click(function(){$(this).parent().find("textarea").focus()}),trafficlogging){var lastStatsMsg="";setTimeout(logCounters,3e3)}}),!$("#dl_quotes_article").length||window.kDeepL&&window.kDeepL.isLoggedIn()||function(){function e(e){var t=0;e&&s.css("font-family","sans-serif"),$(".dl_quotes__text").each(function(){var e=$(this).height();e>t&&(t=e)}),e&&s.css("font-family",""),s.height(t);var n=parseInt(s.css("padding-left"));$(".dl_quotes__text").css({position:"absolute",left:n+"px",right:n+"px",top:"50%",transform:"translateY(-50%)",display:"block"})}function t(){$(".dl_quotes__source_name.dl_visible a").length>0?h.addClass("dl_visible"):h.removeClass("dl_visible")}function n(){if(f=Date.now()+100,$(".dl_quotes__text, .dl_quotes__image, .dl_quotes__source_name").removeClass("dl_visible"),0!=l.find(".dl_quotes__image").length){var e=(d%_.length+_.length)%_.length,n=_[e];if(n){i&&console.log("[quotes] QUOTE ",e+1,"/",_.length,n),n.forEach(function(e){e.addClass("dl_visible")}),t(),clearTimeout(m),m=setTimeout(function(){n.forEach(function(e){e.appendTo(e.parent())})},1250),clearTimeout(g);var o=parseInt(s.find(".dl_quotes__text.dl_visible").attr("data-time-visible")||"0"),c=r+o;i&&console.log("[quotes] Additional time:",o,"theDelay:",c),g=setTimeout(a,c)}}}function a(){var e=o;blockTimeout=Date.now()+1250,e?(i&&console.log("[quotes] Next quote..."),++d,n()):setTimeout(a,r+5e3)}var i=!1;i&&console.log("[quotes] Preparing Quotes section.");var r=1e4,o=!0,s=$("#dl_quotes_article .dl_quotes__text_block"),l=$("#dl_quotes_article .dl_quotes__image_container"),c=$("#dl_quotes_article .dl_quotes__source_name_container"),u=window.dlCurrentLocalizedTexts&&dlCurrentLocalizedTexts()||{},d=-1;$(window).focus(function(){o=!0}).blur(function(){o=!1});var _=function(){var e=[];return(window.QuoteTexts||[]).forEach(function(t,n){console.log("Quote:",t);var a=t[1];if(a&&a.trim().length){var i=$("<p id='press"+n+"_text' class='dl_quotes__text'>").html(a).attr("data-time-visible",t[4]).prependTo(s),r=$("<div id='press"+n+"_name' class='dl_quotes__source_name'>").html(t[2]).prependTo(c),o=$("<img id='press"+n+"_image' class='dl_quotes__image dl_quotes__image--press'>").attr("src","img/quote_pictures/"+t[3]).prependTo(l);r.find("a").length>0&&o.css("cursor","pointer"),e.push([i,o,r])}else console.warn("[quotes] Empty quote!")}),e}();if(0!=_.length){setTimeout(function(){$("#dl_quotes_article").addClass("dl_visible"),a()}),e(!0),$(window).resize(function(){e()});var h=$(".dl_quotes__link_to_quote"),p=dl.uiLangCode;("Read the article"!=u.translatorQuoteLink||"EN"==p)&&t();var f=0,g=0,m=0,v=parseInt(s.find(".dl_quotes__text.dl_visible").first().attr("data-time-visible")||0),T=r+2e3+v;i&&console.log("[quotes] initial delay",T),g=setTimeout(a,T),h.add(".dl_quotes__image--press").click(function(){var e=$(".dl_quotes__source_name.dl_visible a");if(console.log("[quotes] Clicked article",e),e.length>0){var t=e.first().attr("href");window.open(t,"_blank")}}),$(".dl_quotes__next_button").click(function(){Date.now()>f&&(i&&console.log("[quotes] Forward"),clearTimeout(g),++d,n())}),$(".dl_quotes__prev_button").click(function(){Date.now()>f&&(i&&console.log("[quotes] Backward"),clearTimeout(g),--d,n())})}else console.error("[console] No Quotes !")}(),M.define("LMT_UI_late",["RPC","U","PubSub","$","queryVars","LMT_UI"],function(e,t,n,a,i,r){return{init:function(o,l){function c(e,t,n){var a=[],i=0,r=[];return e.forEach(function(e,o){var s=n?n(e,o):1;i+s<=t||0==r.length?i+=s:(a.push(r),i=s,r=[]),r.push(e)}),r.length&&a.push(r),a}function u(e){var n=a(e);return navigator.clipboard&&navigator.clipboard.writeText?(ae("Use clipboard api!"),navigator.clipboard.writeText(n.val())):new Promise(function(e,a){var i=t.createCallOnce();if(n.focus().get(0).select(),dl.isIPad||dl.isIPhone){var r=document.createRange();r.selectNodeContents(n[0]);var o=window.getSelection();o.removeAllRanges(),o.addRange(r),n[0].setSelectionRange(0,9999999),i.push(function(){n.attr("contentEditable",!1)})}try{document.execCommand("copy")?(i(),ae("[copyTextFromInputElement] Copying text command was successful."),e()):(i(),ae("[copyTextFromInputElement] Copying text command failed."),a("Could not copy."))}catch(e){i(),console.warn("Unable to copy"),a(e)}})}function d(){return++d._counter}function _(e,t){this[Fe]="State_#"+Ae+++"_"+e+"_"+t,this[$e]=e,this[Ge]=t,this[We]=new Object(null),this[He]=[],this[je]=[],ae("Created new State ",this[Fe])}function h(e,t){return window.dl_texts&&window.dl_texts[e]||window.dl_texts&&window.dl_texts["translator/"+e]||window.dl_localizedTexts&&window.dl_localizedTexts["translator/"+e]||t||e}function p(e){this[tt]=Ae++,this[nt]=e,this[at]=void 0,this[it]="",this[rt]="",this[ot]="",this[st]=d(),this[lt]=this[st],this[ct]=this[st]}function f(e){this[dt]=Ae++,this[ut]=e,this[_t]=[],this[ft]=new Object(null),this[gt]=e.trim(),this[vt]=-1,this[mt]=[],this[Tt]=-1,this[yt]=-1}function g(e,t){return{errorType:xt,rpcError:e,statusCode:e&&e.data&&e.data.status,trigger:t}}function m(e){return{errorType:Ct,message:e}}function v(e,t){return JSON.stringify(e)+":"+JSON.stringify(t)}function T(t,n,a,r,o){var s=!1;return new Promise(function(t,l){function c(r){Pt({jobs:n,lang:a,priority:u},pe?{queryParams:{"x-simulate-too-many-requests":"1"}}:void 0).then(function(e){Y(Ee,"translation"),i.logRequests&&(ae("<<<< Result: "),ae(JSON.stringify(e)),ae(">>>>"));var a=e[kt];if(!Array.isArray(a))return console.warn("Invalid result:"),ae("<<<< Result: "),ae(JSON.stringify(e)),ae(">>>>"),void l(m("Invalid translation results."));var r=0;a.forEach(function(e){var t=e.beams;Array.isArray(t)&&t.length>0&&(r+=t[0].num_symbols)});var o="";if(Array.isArray(n)&&n.length>0&&(o=n[0].kind),"default"!=o||(qt+=r,Mt+=1),a.length==n.length){var c=Object.keys(It);s&&ae("[sendTranslationJobs] Cache: "+c);if(c.length>=400)for(var u=0;u<200;u++)delete It[c[u]];It[d]=e}t(e)},function(t){if(Y(Se,"translation",t),console.warn("[sendTranslationJobs] Error during translation request (retryNr "+r+": ",t),!o||r>=3||t&&t.errorType===e.ErrorTypes.REQUEST_FAILED&&t.data&&(403===t.data.status||456===t.data.status))l(g(t,"translation"));else{var n=3e3+5e3*r;console.log("[sendTranslationJobs] Trying again in "+n+"ms!"),setTimeout(function(){c(r+1)},n)}})}var u=void 0===r?1:r;i.logRequests&&(ae("<<<< Request: (prio "+u+")"),ae(JSON.stringify(n)),ae(JSON.stringify(a)),ae(">>>>"));var d=v(n,a),_=It[d];_?(ae("Using cached translation job result.",a),t(_)):c(0)})}function y(e){var t=e.match(Ft);return t?t[1]?[t[1],t[2]]:[t[3],t[4]]:["",e]}function b(e,t){function n(e,t,n){var i=e.getParts();if(i.length){t[0]!==i[0].text&&(i[0].isWhitespacePart||t[0].match(/^\s+$/))&&(a&&ae("[refreshTargetDataFromText] New prefix whitespaces ["+t[0]+"] ["+i[0].text+"]"),e[Tt]=d());var r=i[i.length-1],o=t[t.length-1];o!==r.text&&(r.isWhitespacePart||o.match(/^\s+$/))&&(a&&ae("[refreshTargetDataFromText] New postfix whitespaces ["+t[t.length-1]+"]"),e[yt]=d())}e.setText(t.join(""),!1),n&&(e[vt]=d())}var a=!1;if(e[Be]!==t){var i=e[Be]=t,r=(e[He],function(e){var t=[];return e.replace(Ut,function(e,n){t.push({isWhitespacePart:!!e.match(/\s/),text:e,offset:n})}),t}(i));a&&ae("[refreshTargetDataFromText] parts ",r.slice(0));var o,s,l=e[je].slice(0);a&&ae("[refreshTargetDataFromText] <<<< ");for(p=l[0];p;){for(var c=p.getParts(),u=0,_=0,h=!1;;){for(g=c[_];g&&g.isWhitespacePart;)g=c[++_];for(f=r[u];f&&f.isWhitespacePart;)f=r[++u];if(!g){h=!0;break}if(!f)break;if(f.text!==g.text){a&&ae("[refreshTargetDataFromText] ["+f.text+"] ["+g.text+"] ",p);break}++u,++_}if(!h){a&&ae("[refreshTargetDataFromText] No match.");break}a&&ae("[refreshTargetDataFromText] Sentence matched (front)!",p);if((m=r.splice(0,u)).length){v=m[m.length-1];if(a&&ae("[refreshTargetDataFromText] The last matched part ["+v.text+"]",v.isWhitespacePart),v.isWhitespacePart){T=y(v.text);a&&ae("[refreshTargetDataFromText] Between sentence whitespaces (1): ","["+T[0]+"]","["+T[1]+"]"),v.text=T[0],T[1].length&&(r.unshift({text:T[1],isWhitespacePart:!0}),a&&ae("[refreshTargetDataFromText] Between sentence whitespaces (2): ","["+T[0]+"]","["+T[1]+"]"))}}w=[];m.forEach(function(e){w.push(e.text)}),n(p,w,!1),o=p,l.shift(),p=l[0],a&&ae("----------")}a&&ae("--------");for(var p=l[l.length-1];p;){for(var f,g,c=p.getParts(),u=r.length-1,_=c.length-1,h=!1;;){for(g=c[_];g&&g.isWhitespacePart;)g=c[--_];for(f=r[u];f&&f.isWhitespacePart;)f=r[--u];if(!g){h=!0;break}if(!f)break;if(f.text!==g.text){a&&ae("[refreshTargetDataFromText] Mismatch: ["+f.text+"] ["+g.text+"] ",p);break}--u,--_}if(!h){a&&ae("[refreshTargetDataFromText] No match.");break}a&&ae("[refreshTargetDataFromText] Sentence matched (back)!",p);var m=r.splice(u+1);if(m.length){var v;if((v=m[0]).isWhitespacePart){var T=y(v.text);v.text=T[1],T[0].length&&(r.push({text:T[0],isWhitespacePart:!0}),a&&ae("[refreshTargetDataFromText] Between sentence whitespaces (2): ","["+T[0]+"]","["+T[1]+"]"))}}w=[];m.forEach(function(e){w.push(e.text)}),n(p,w,!1),s=p,l.pop(),p=l[l.length-1],a&&ae("----------")}if(a&&e[je].forEach(function(e,t){ae("[refreshTargetDataFromText] tSentence ",t,"["+e[ut]+"]")}),1==l.length&&r.length){var b=l.shift(),w=[];r.splice(0).forEach(function(e){w.push(e.text)}),n(b,w,!0),a&&ae("[refreshTargetDataFromText] Assign remaining parts to single sentence: ",b)}else if(!l.length&&r.length){var x=0;if(o||s?o&&!s?x=-1:!o&&s?x=1:(a&&r.forEach(function(e,t){ae("[refreshTargetDataFromText] RemainingPart ",t,"[",e.text+"]")}),x=o[ut].match(/(\n|[!?])\s*$/)?1:-1):ae("[refreshTargetDataFromText] Parts can't be assigned..."),x>0){w=[];r.splice(0).reverse().forEach(function(e){w.unshift(e.text)}),w.push(s[ut]),n(s,w,!0),a&&ae("[refreshTargetDataFromText] Append to sentence after. ",s)}else if(x<0){w=[o[ut]];r.splice(0).forEach(function(e){w.push(e.text)}),n(o,w,!0),a&&ae("[refreshTargetDataFromText]Append to sentence before. ",o)}}else if(l.length&&r.length){console.warn("[refreshTargetDataFromText] alignment is lost. Todo!");w=[];r.splice(0).forEach(function(e){w.push(e.text)});n(b=l.shift(),w,!0)}else a&&ae("[refreshTargetDataFromText] refreshTargetDataFromText everything ok.");a&&ae("[refreshTargetDataFromText] >>>>>>>> ")}else a&&ae("[refreshTargetDataFromText] No changes.")}function w(){return Z.prop("selectionStart")}function x(e,t){var n,a=t;return e[je].some(function(i,r){var o=i[ut].length;if(a<=o||r==e[je].length-1)return o>0&&a==o&&r<e[je].length-1&&"\n"==i[ut][o-1]?(a-=o,!1):(n={sentence:i,sentenceCursorOffset:a,cursorOffset:t},!0);a-=o}),n}function C(){var e=C.$container;e||(e=a("<div>Dummy</div>").addClass("lmt__textarea_base_style").css({position:"absolute",transform:"translate(-500%, -500%)"}).appendTo(o),C.$container=e),window._posDummyTarget=e;var t=Z.hasClass("lmt__textarea--iOSTextareaFix");return e.css(Z.dlCSS("padding-top","padding-bottom","padding-left","padding-right","margin","overflow-x","overflow-y","font-family","font-size","font-stretch")).css("line-height",Z.css("line-height")).height(Z.height()).innerWidth(Z[0].getBoundingClientRect().width-(t?6:0)),t&&e.css("padding-left",parseInt(e.css("padding-left"))+3+"px"),e}function E(e){var t=C(),n=Z.val(),i=n.substr(0,e),r=n.substr(e);t.empty();t[0];a("<span></span>").text(i).appendTo(t).css("outline","1px solid green");var o=a("<span></span>").css("outline","1px solid red").css("position","relative").appendTo(t),s=r.match(Bt)[0],l=a("<span></span>").text(s).appendTo(t).css("outline","1px solid blue"),c=o.position();return c.top<=1&&c.left<=1&&(c=l.position()),c.top-=Z.scrollTop(),c}function S(e){var t=Vt,n="[_recalculateFontSizeAndScrollHeight] ";t&&ae(n,"inSourceTextChanged=",e);var i=S;void 0===i.fontScale&&(i.fontScale=100,i.lastHeight=0,i.lastHeightAlternatives=0);var r=X.val(),s=Z.val(),l=i.fontScale,c=80,u=100,d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(d>1e3&&(u=120),d>1200&&(c=90),t&&ae(n,"winWidth="+d+", minScale="+c+", maxScale="+u),e||l<c||l>u){if(0!=X.scrollTop())return X.scrollTop(0),void setTimeout(function(){S(e)});var _=r.split("\n"),h=0,p=80;d<2e3&&(p=65),d<1250&&(p=50),d<1250&&(p=40),d<800&&(p=20);for(var f=0;f<_.length;f++)h+=1+_[f].length/p;l=h<=2?u:h<=(dl.isMobilePhone,3)?100:h<=(dl.isMobilePhone?5:10)?90:80,t&&ae(n,"numLines="+h+", theScale="+l),l!=i.fontScale&&(t&&ae(n,"Changed font scale: numLines="+h+", new scale="+l),o.find(".lmt__textarea_container").css("font-size",l+"%"),i.fontScale=l)}var g=a("<div class='lmt__textarea' style='min-height: 0;'></div>"),m=X.closest(".lmt__textarea_container");g.css(X.dlCSS("font","font-size","font-family","font-variant-ligatures","padding-top","padding-bottom","padding-left","padding-right")),m.append(g),g.css({"white-space":"pre-wrap","font-variant-ligatures":"none",transform:"translate(0%, 100%)"}),g.text(s+":"),t&&ae(n,"theScrollarea",m),t&&ae(n,"theTextarea.height",g.height());var v,T=g.height()+30;if(e){g.text(r+":"),v=g.height();var y=parseInt(X.css("min-height"))-parseInt(X.css("padding-top"))-parseInt(X.css("padding-bottom"));y>v&&(v=y),Qt=v}else v=Qt;if(g.remove(),t&&ae(n,"Needed textarea heights: source_height="+v+", target_height="+T),v<30&&(v=30),T<30&&(T=30),!dl.isMobilePhone){var b=ee.height(),w=v>T+b?v:T+b;if(!e&&w<i.lastHeight&&b<i.lastHeightAlternatives)return;t&&ae(n,"HEIGHTS: source="+v+", target="+T+", target_alternatives="+b+", new_source="+w+", new_target="+(w-b)+", inSourceTextChanged="+e),v=w,T=w-b,i.lastHeight=w,i.lastHeightAlternatives=b}t&&ae(n,"Setting textarea heights: source_height="+v+", target_height="+T),X.height(v),Z.height(T),Y(De)}function L(e){return e.stopPropagation(),e.preventDefault(),e.returnValue=!1,!1}function R(e,n){this[Jt]=e,this[Yt]=n,this[en]=t.createCallOnce(),this[Xt]=void 0,this[Zt]=t.createCallOnce(),this.sourceLangHasBeenDetermined=void 0}function k(e,t){var n=Z.val();an!==n&&(ae("TARGET CHANGED BECAUSE OF ",e,t),an=n,Y(Ne))}function O(e){this.msg=e}function N(e,t){var n=N,a=e[0];if(!K[Q]||!n._insertWorks&&n._checkedIfInsertWorks)e.val(t);else{var i=e.val();try{if(a.focus(),document.activeElement===a){var r=function(e,t){for(var n=e.split("\n"),a=t.split("\n"),i=0;n.length&&n[n.length-1]===a[a.length-1];)n.pop(),a.pop();for(;n.length&&n[0]===a[0];)i+=n[0].length+1,n.shift(),a.shift();var r="",o="";if(n.length){for(var s=n.join("\n"),l=a.join("\n"),c=0;c<s.length&&s.charAt(c)===l.charAt(c);)++c,++i;for(var u=s.length-1,d=l.length-1;u>=c&&d>=c&&s.charAt(u)===l.charAt(d);)--u,--d;r=s.substr(c,u-c+1),o=l.substr(c,d-c+1)}return[i,r,o]}(e.val(),t);a.setSelectionRange(r[0],r[0]+r[1].length),document.execCommand("insertText",!1,r[2])}else ae("[updateTextareaText] Can't select element."),e.val(t)}finally{n._checkedIfInsertWorks||i===t||(n._checkedIfInsertWorks=!0,e.val()===t?n._insertWorks=!0:(n._insertWorks=!1,e.val(t),ae("[updateTextareaText] execCommand is not supported. Undo does not work!")))}}}function D(e){if(e===Ve){var t=[];e[je].forEach(function(e){var n=e[ut];t.push(n)});var n=t.join("");e[Be]=n,A(n)}}function A(e){N(Z,e),nn("update"),S(!1)}function P(e,t){var n=e;return"DE"!=t||i.norepair||(n=n.replace("/Ã¤","ä").replace("Ã„","Ä").replace("Ã¶","ö").replace("Ã–","Ö").replace("Ã¼","ü").replace("Ãœ","Ü").replace("ÃŸ","ß").replace("Ã? ","ü").replace("Ã?","ü").replace("ÃŒ","ü").replace("Ã","")),n!=e&&console.log('repaired text from "'+e+'" to "'+n+'"'),n}function I(e,n,a,i,r){return new Promise(function(o,s){i=P(i,Qe.targetLang);var l=n[ut].substr(a.length).match(/\s*$/)[0];if(ae("[request_replacePartOfTargetSentence] ["+a+"]["+i+"]","whitespaces["+l+"]"),K[V]){var c=n.getNormalizedTextAndOffset(a.length),u=c[0],h=c[1],p=n[ut].substr(a.length).trim().split(/\s+/),f=a.trim().split(/\s+/),g=f.slice(f.length-3).join(" "),m=p.slice(0,1).join(" "),v=u.substr(0,h);ae("[request_replacePartOfTargetSentence] ctxt["+g+"] old["+m+"] new["+i+"]");var y=n[pt]||(n[pt]=new Object(null));y.previous_sentence=u;var b=[],w={phrase:i,pre_context:v};y.chosen_phrases&&y.chosen_phrases.forEach(function(e){w.pre_context!==e.pre_context&&b.push(e)}),b.push(w),y.chosen_phrases=b;var b=[],w={phrase:m,pre_context:v};y.overridden_phrases&&y.overridden_phrases.forEach(function(e){w.phrase===e.phrase&&w.pre_context===e.pre_context||w.pre_context===e.pre_context&&e.phrase===i||b.push(e)}),b.push(w),y.overridden_phrases=b,ae(y)}n.setText(a+i+l,!1),n[vt]=d(),D(e),t.notify("LMT/translationChanged"),r?(n.setText(a+i,!1),n[vt]=d(),function(e,t,n){return new Promise(function(a,i){var r=t.getNormalizedTextAndOffset(0)[0],o=t.getParts(),s="";o.length&&o[0].isWhitespacePart&&(s=o[0].text);var l=void 0===n?" ":n,c=r;ae("[request_fillUpTargetSentence] ["+s+"]["+c+"][...]["+l+"]");var u=t.getTranslation();if(u){var h={kind:Et,de_sentence_beginning:c,raw_en_sentence:u[ze]},p=t[pt];p&&(h.previous_sentence=p.previous_sentence,h.chosen_phrases=p.chosen_phrases,h.overridden_phrases=p.overridden_phrases);var f=_.getLangConfigForTranslation();Y(we,"fillUp"),T(0,[h],f,1,!0).then(function(n){Y(Ee,"fillUp"),Y(xe,"fillUp");var i=n[kt][0].beams;if(i.length){var r=s+P(i[0].postprocessed_sentence,Qe.targetLang)+l;t.setText(r,!0),t[vt]=d()}else ae("request_fillUpTargetSentence: No Result found");D(e),a()},function(e){Y(xe,"fillUp"),i(e)})}else ae("[request_fillUpTargetSentence] No Translation object.")})}(e,n,l).then(function(e){t.notify("LMT/translationChanged"),o(e)},s)):(n.setText(a+i,!0),o())})}function q(){this[fn]=void 0,this[mn]=0,this[gn]=0,this[bn]="alternatives"}function U(){var e=Ve,t=Z.val();b(e,t);var n=w(),a=n;if(t.charAt(a).match(hn))for(;a>0&&t.charAt(a-1).match(hn);)--a;var i=x(e,a);if(i){var r=E(a);E(a+1).top>r.top+5&&(i.caretAtNextLine=!0)}ae("[triggerAlternativePopup] Click on sentence:",n,a,i),Y(ve,e,i)}function F(e,t){var n=e.attr("dl-displayed");t&&n!==t&&(ae("displayLang "+t+" for "+(e.hasClass("lmt__language_select--source")?"source":"target")+": changing from "+n+" to "+t+"."),e.attr("dl-displayed",t),$(e))}function $(e){var t=e.attr("dl-value"),n=e.attr("dl-displayed");ae("displayCorrectLangLabel for "+e.attr("id")+": value="+t+", displayed="+n);var i=e.find("label");if(e.hasClass("lmt__language_select--source")){var r="auto"!=n?n:t;if("auto"==n){o=h("translator/detectLanguage","<span class='translate_from'>Translate from </span><strong>any language</strong>");i.html(o)}else if("auto"==t){var o=h("translator/translateFrom","<span class='translate_from'>Translate from </span>"),s=h("translator/translationLanguageDetected","(detected)");i.html(o+"<strong>"+e.find("li[dl-value='"+r+"']").html()+"</strong> "+s)}else{o=h("translator/translateFrom","<span class='translate_from'>Translate from </span>");i.html(o+"<strong>"+e.find("li[dl-value='"+n+"']").html().trim()+"</strong>")}Ln.find("li").show()}else{var l=e.find("li[dl-value='"+(n||t)+"']").html();i.find("strong").html(l?l.trim():"")}Rn.find("li").show(),Rn.find("li[dl-value='"+a(Ln).attr("dl-displayed")+"']").hide()}var G=window.kDeepL&&window.kDeepL.isLoggedIn();console.log("DeepL Translator"+(G?" with API support":""));var W;W=i.backend?i.backend:G?location.href.match(/test\.deepl\.com/)||location.href.match(/local\.deepl\.com/)?"https://api-test.deepl.com/jsonrpc":"https://api.deepl.com/jsonrpc":location.href.match(/local\.linguee\.com/)||location.href.match(/local\.deepl\.com/)||location.href.match(/localhead\.deepl\.com/)||location.href.match(/.*dev\.linguee\.com/)?"https://www.deepl.com/jsonrpc":l,"1"===i.reset_tutorial&&localStorage.removeItem("LMT_MessageBox");var H=t.scheduleNonConcurrentRequest,j=t.setTimeout_consolidated,B=function(){var e,t;if(window.localStorage&&window.localStorage.getItem&&window.localStorage.setItem)e=function(e,t){window.localStorage.setItem(e,t)},t=function(e){return window.localStorage.getItem(e)};else{var n=new Object(null);e=function(e,t){n[e]=t},t=function(e){return n[e]}}return{getValue:function(e,n){try{var a=JSON.parse(t(e)||"")}catch(e){return n}return void 0===a?n:a},setValue:function(t,n){e(t,JSON.stringify(n))}}}();window._PersistentStorage=B;var V="CONFIG__DECISION_HISTORY",Q="CONFIG__UNDO",K=new Object(null);K[V]=!!i.decisionHistory,K.CONFIG__SHOW_ALTERNATIVES=!!i.showAlternatives,K.CONFIG__BLOCK_SCROLLING="0"!=i.blockScrolling,K.CONFIG__HIGHLIGHT="0"!=i.highlight,K[Q]="0"!=i.undo,K.CONFIG__UPDATE_TARGET_SENTENCES="0"!=i.update,K.CONFIG__ADD_TRANSLATION_FOOTER=!G;var z=n.create(),J=z.listenOn.bind(z),Y=z.notify.bind(z),X=o.find(".lmt__source_textarea"),Z=o.find(".lmt__target_textarea"),ee=o.find(".lmt__translations_as_text"),te=(o.find(".lmt__source_textarea .lmt__target_textarea"),a("<div class='lmt__edit_text_popup lmt__scrollable'></div>").insertAfter(Z)),ne=a("<div class='lmt__busy_indicator'></div>").insertAfter(Z),ae=i.logging?console.log.bind(window.console):function(){},ie=i.logging,re="source_lang_changed",oe="target_lang_changed",se="source_text_changed";ae("Welcome!"),i.type&&"multi1"!==i.type&&a("<div></div>").text(i.type).css({position:"absolute",right:"0",top:"0",color:"#ccc"}).appendTo(o);var le=1e4,ce=1500,ue=G?1e7:5e3,de=G?1e3:500,_e=1e4,he=G?4e3:1e4,pe=!1,fe="ON__ANYCLICK",ge="ON__ACTIVE_ELEMENT_CHANGED",me="ON__START_BATCHED_TRANSLATION_REQUEST",ve="ON__CLICK_TARGET_SENTENCE",Te="ON__INITIAL_SOURCE_TRANSLATION_UPDATED",ye="ON__INTERCEPT_COPIED_TRANSLATION",be="ON__PARTIAL_TRANSLATION_RECEIVED",we="ON__REQUEST_STARTED",xe="ON__REQUEST_ENDED",Ce="ON__REQUEST_FAILED",Ee="ON__RPC_CALL_SUCCESSFULL",Se="ON__RPC_CALL_FAILED",Le="ON__SOURCE_TEXT_CHANGED",Re="ON__SOURCE_TEXT_EMPTY",ke="ON__TARGET_POPUP_OPENED",Oe="ON__TARGET_POPUP_CLOSED",Ne="ON__TARGET_EDIT_TEXT_CHANGED",De="ON__TEXT_AREAS_RESTYLED",Ae=0;d._counter=0;var Pe="GSTATE__FORCE_SENTENCE_SPLITTING_REQUESTS_FOR_STABILITY",Ie="GSTATE__TYPING_REQUESTS_BLOCKED_UNTIL",qe="GSTATE__ONLY_TRANSLATE_FIRST_SENTENCE",Me="GSTATE__EDIT_FEATURES_DISABLED",Ue=new function(){this[Pe]=t.createValueWrapper(!1),this[Ie]=0,this[qe]=t.createValueWrapper(!1),this[Me]=t.createValueWrapper(!1)};r.globalState=Ue;var Fe="name",$e="lang1",Ge="lang2",We="translations",He="sSentences",je="tSentences",Be="tText";_.reset=function(){Ve[$e],Ve[Ge];Ve=new _("","")};var Ve,Qe=r;window._getLocalizedText=h,(_.currentLangPair=t.createValueWrapper("")).onValueChanged.push(function(e){ae("newLangPair",e);var t=e.split("-");ae("langCodes",t),(!Ve||t[0]&&t[0]!=Ve[$e]||t[1]&&t[1]!=Ve[Ge])&&(Ve=new _(t[0],t[1])),ae("Set new State ",Ve[$e],Ve[Ge]),window._tState=Ve}),_.switchSourceLang=function(e){"auto"!=Qe.selectedSourceLang&&e!=Qe.selectedSourceLang&&(Qe.selectedSourceLang="auto"),_.switchLangCodes(e,Ve[Ge])},_.switchLangCodes=function(e,t){_.currentLangPair((e||Ve[$e])+"-"+(t||Ve[Ge])),Y("ON__LANGUAGE_CHANGED",Ve[$e],Ve[Ge])},_.currentLangPair("-"),_.getLangConfigForTranslation=function(){return{source_lang_computed:Ve[$e],target_lang:Ve[Ge]}};var Ke="id",ze="sText",Je="initText",Ye="altInitTexts",Xe="altRq",Ze="localRq",et="initResult",tt="id",nt="translations",at="preTranslations",it="wsBefore",rt="wsAfter",ot="rawText",st="sRev",lt="wsBeforeRev",ct="wsAfterRev";p.prototype.setWhitespacesAfter=function(e){e!==this[rt]&&(this[rt]=e,this[ct]=d())},p.prototype.setWhitespacesBefore=function(e){e!==this[it]&&(this[it]=e,this[lt]=d())},p.prototype.getText=function(){return this[it]+this[ot]+this[rt]};var ut="tText",dt="id",_t="sSentences",ht="parts",pt="decisions",ft="knownTexts",gt="lastFullText",mt="acResults",vt="tsRev",Tt="tsWsBRev",yt="tsWsARev";f.prototype.getSourceSentence=function(){return this[_t][0]},f.prototype.getTranslation=function(){var e=this[_t][0];return e&&e[nt]},f.prototype.setSourceSentence=function(e){this[_t][0]!==e&&this[_t].unshift(e)},f.prototype.setText=function(e,t){if(this[ut]=e,this[ht]=void 0,t){var n=e.trim();this[ft][n]=!0,this[gt]=n}};var bt=/^\s*/,wt=/\s*$/;f.prototype.getParts=function(){return this[ht]||(this[ht]=function(e){var t=[];return e.replace(Ut,function(e,n){t.push({isWhitespacePart:!!e.match(/\s/),text:e,offset:n})}),t}(this[ut])),this[ht]},f.prototype.getNormalizedTextAndOffset=function(e){var t=0,n=[];return this.getParts().forEach(function(a,i){var r;r=a.isWhitespacePart?0==i?"":" ":a.text,e>=a.text.length?(t+=r.length,e-=a.text.length):e>=0&&(t+=Math.min(e,r.length),e-=a.text.length),n.push(r)}),[n.join(""),t]},f.prototype.getWhitespacesBefore=function(){return this[ut].match(bt)[0]},f.prototype.getWhitespacesAfter=function(){return this[ut].match(wt)[0]},f.prototype.getText=function(){return this[ut]};var xt="ERROR_TYPE__RPC_ERROR",Ct="ERROR_TYPE__UNEXPECTED",Et="default",St="autocompletion",Lt="alternatives_at_position",Rt="postprocessed_sentence",kt="translations",Ot="source_lang",Nt="target_lang",Dt=e.connectTo({url:W,method:"POST",withCredentials:!0}).getFunction("LMT_split_into_sentences"),At=/[.!?\":].*\S.*$/m,Pt=e.connectTo({url:W,method:"POST",timeout:12e4,withCredentials:!0}).getFunction("LMT_handle_jobs"),It={},qt=0,Mt=0,Ut=/\s+(?=\S|$)|\S+(?=\s|$)/g,Ft=/^(\s*?\n)(\s*)|( ?)(\s+)$/,$t=function(){function e(e){e._timer&&(clearTimeout(e._timer),e._timer=null)}function t(e){var t,a=e._id,r=function(){var e;try{e=JSON.parse(window.localStorage&&window.localStorage.getItem(i))}catch(e){ae("[_storageData]",e)}return(!e||!e.version||e.version<n)&&(e={version:n,messageBoxes:{}}),e.save=function(){window.localStorage&&window.localStorage.setItem(i,JSON.stringify(e))},e}();return a in r.messageBoxes?t=r.messageBoxes[a]:(t={displayCount:0},r.messageBoxes[a]=t),t.save=r.save,t}var n=2,i="LMT_MessageBox",r=/LMT_(top|left|right|bottom)_peak/;return{create:function(n,i){return{_id:n,_box:a("<div class='lmt__message_box'><div class='lmt__message_box__top_peak'></div><div class='lmt__message_box__left_peak'></div><div class='lmt__message_box__background'></div><div class='lmt__message_box__right_peak'></div><div class='lmt__message_box__bottom_peak'></div></div>").append(a("<div class='lmt__message_box__content'></div>").html(i)).appendTo(a("body")),_maximalDisplayCount:null,content:function(e){var t=this._box.find(".lmt__message_box__content"),n=t.html();return void 0!==e&&t.html(e),n},direction:function(){var e="top";return this._box.find("> div:visible").each(function(){var t=this.className.match(r);t&&t.length>1&&(e=t[1])}),e},position:function(e,t){var n=t||this.direction(),a=this._box.outerWidth(),i=this._box.outerHeight(),r=this._box.offset();switch(n){case"top":r.top=e.top,r.left=e.left-a/2;break;case"left":r.top=e.top-i/2,r.left=e.left;break;case"right":r.top=e.top-i/2,r.left=e.left-a;break;case"bottom":r.top=e.top-i,r.left=e.left-a/2}return function(e){e.find(".lmt__message_box__top_peak,.lmt__message_box__left_peak,.lmt__message_box__right_peak,.lmt__message_box__bottom_peak").css("display","")}(this._box),this._box.find(".lmt__message_box__"+n+"_peak").css("display","block"),this._box.offset(r),this},isHidden:function(){return this._box.css("opacity")<.1||"hidden"==this._box.css("visibility")},show:function(n,a,i,r){if(function(e){e._maximalDisplayCount&&e._maximalDisplayCount<=e.displayCount()&&e.disable(!0)}(this),this.isHidden()&&!this.isDisabled()){var o=this,s=this._box;e(this),this._timer=setTimeout(function(){this._timer=null,r&&!r()||(s.css("visibility","visible"),s.animate({opacity:1},n||0,"swing",i),function(e){var n=t(e);n.displayCount++,n.save()}(o))},a)}return this},hide:function(t,n,a){var i=this._box;return e(this),this._timer=setTimeout(function(){this._timer=null,i.animate({opacity:0},t||0,"swing",function(){i.css("visibility",""),a&&a()})},n||0),this},isDisabled:function(){return 0==this._box.parent().length},disable:function(e){e!=this.isDisabled()&&(e?this._box.remove():a("body").append(this._box))},displayCount:function(){return t(this).displayCount},maximalDisplayCount:function(e){var t=this._maximalDisplayCount;return null!=e&&e>=0&&(this._maximalDisplayCount=e),t},width:function(e){var t=this._box.width();return e&&this._box.width(e),t}}}}}();window._MessageBox=$t;var Gt=function(){function e(){t&&(t.remove(),t=null)}var t=null;return{open:function(n,i,r){var o=a("<div class='lmt__fullscreen_alert__content'></div>");if(e(),t=a("<div id='lmt__fullscreen_alert'><div class='lmt__fullscreen_alert__background'></div></div>"),"string"==typeof n){var s=a("<p></p>");s.html(n),o.append(s)}else o.append(n);if(t.append(o),i){var l=a("<a class='lmt__fullscreen_alert__button'></a>");l.html(i),l.click(e),o.append(l)}r&&t.addClass(r),a("body").append(t)},close:e}}();window._SystemAlert=Gt;var Wt=function(){function e(e){var t,i,r=Date.now();e.notifications.splice(0).forEach(function(a){a.validUntil<r?(a.node.remove(),a.timerId&&clearTimeout(a.timerId),delete n[a.id]):(e.notifications.push(a),a.node.detach(),(!t||a.priority>i)&&(i=a.priority,t=a))}),t&&t.node.prependTo(a(".lmt__translator"))}var t=new Object(null),n=new Object(null);return{addNotification:function(i){var r=i.id;n[r]&&(n[r].validUntil=0);var o=function(e){return t[e]||(t[e]={notifications:[]}),t[e]}(i.category||"default"),s={id:r,node:a("<div class='lmt__system_notification'></div>").addClass(i.severity?"lmt__system_notification--"+i.severity:"").html(i.text),priority:i.priority||-1/(1+o.notifications.length),validUntil:i.timeout_sec?Date.now()+1e3*i.timeout_sec:2*Date.now(),timerId:i.timeout_sec&&setTimeout(function(){s.validUntil=0,e(o)},1e3*i.timeout_sec),channel:o};return n[r]=s,o.notifications.push(s),e(o),function(){s.validUntil=0,e(o)}},removeNotification:function(t){n[t]&&(n[t].validUntil=0,e(n[t].channel))},hasNotification:function(e){return n[e]&&n[e].validUntil>Date.now()}}}();window._SystemNotification=Wt;var Ht={show:function(e){var t=e.content||"";if(t){var n=e.timeout||500,i=e.x||0,r=e.y||0;if(e.target){var o=a(e.target).offset();i+=o.left,r+=o.top}var s=a("<div class='lmt__feedback_message'></div>").html(e.content).css({top:r+"px",left:i+"px"}).appendTo(a("body"));e.class&&s.addClass(e.class),setTimeout(function(){s.addClass("lmt__feedback_message--visible")}),setTimeout(function(){s.addClass("lmt__feedback_message--fading"),setTimeout(function(){s.remove()},400)},n),console.log("[FeedbackMessage]",t)}}};window._FeedbackMessage=Ht;var jt=function(){function e(e,t){a(e).find("[title]").each(function(e,t){var o=t.getAttribute("title");t.removeAttribute("title"),function(e,t){var o=a(e).get(0);o.addEventListener("mouseenter",function(e){var s=r>Date.now()?100:250;i(),n=o,i.push(function(){n===o&&(n=void 0)}),setTimeout(function(){if(n===o){i();var s="function"==typeof t?t():t,l=a("<div class='lmt__tooltip'>"+s+"</div>").get(0),c=a(e.target).offset();document.body.appendChild(l),l.style.top=c.top+a(e.target).height()+"px";var u=c.left;i.push(function(){r=Date.now()+500,l.classList.add("lmt__tooltip--fading"),setTimeout(function(){l.parentNode.removeChild(l)},200)}),setTimeout(function(){var e=l.getBoundingClientRect().width;e+u>window.innerWidth-10&&(u=window.innerWidth-10-e),l.style.left=u+"px",l.classList.add("lmt__tooltip--visible"),ae("[Tooltip]",s)})}},s)}),o.addEventListener("mouseleave",function(e){i()}),J(fe,i)}(t,o)})}var n,i=t.createCallOnce(),r=0;return{initTooltips:e}}(),Bt=/^\n*[^\n]+\n|.*$/;r.testing_getTargetEditPixelOffsetForCursorOffset=E;var Vt=i.debugSizes||!1,Qt=0;!function(){a(document).click(function(e){Y(fe,a(e.target),e)});var e;window.addEventListener("focus",function(t){document.activeElement!==e&&(e=document.activeElement,Y(ge,a(e)))},!0)}();X.closest(".lmt__textarea_container"),Z.closest(".lmt__textarea_container");var Kt,zt,Jt="state",Yt="initialTrigger",Xt="splitSentenceRequestUsed",Zt="onRequestEnded",en="onSentenceSplittingReceived",tn="REQUEST_CONTEXT__TARGET_IS_PREDEFINED";!function(){function e(e,n){var a=X.val();t!==a&&(t=a,Y(Le,n),e&&setTimeout(function(){X.is(":focus")&&(X.blur().focus(),ae("blur and focus() on source")),Z.is(":focus")&&(Z.blur().focus(),ae("blur and focus() on target"))}))}var t="";Kt=function(t){e(!1,t||new R(Ve,se))},zt=function(e,t){N(X,t),Kt(e)},X.on("change keyup",function(t){Date.now()>Ue[Ie]?(ae("[on source change keyup]: ",t.type),e(!1,new R(Ve,"source_text_changed_by_typing"))):(Y(we,"backupTranslateRequest"),setTimeout(function(){Y(xe,"backupTranslateRequest")},ce+50)),j("assureInitialTranslationIsRequested",function(){e(!1,new R(Ve,se))},ce)}),X.on("paste drop",function(t){setTimeout(function(){e(dl.is_touch_device&&"paste"==t.type,new R(Ve,se))})}),setTimeout(function(){e(!1,new R(Ve,se))},250)}();var nn,an="";Z.on("input change",function(e){k("input",e)}),setTimeout(function(){k("initial")},250),nn=k,a(".lmt__side_container .lmt__clear_text_button").click(function(){var e=a(this).siblings(".lmt__textarea_container"),t=e.find(".lmt__textarea");e.removeClass("dl_large"),N(t,""),t.change(),t.focus()}),a(window).resize(function(){S(!0)}),K.CONFIG__BLOCK_SCROLLING&&function(){var e=void 0,t=0,n=!1,i=0,r=!1,o=!1,s=0;a(document).on("DOMMouseScroll mousewheel",".lmt__scrollable, body",function(l){var c=l.originalEvent,u=Date.now(),d="DOMMouseScroll"==l.type?-40*c.detail:c.wheelDelta,_=a(c.target).closest(".lmt__scrollable"),h=_.length?_[0]:c.target,p=a(h),f=u-s;s=u,(f>250||Math.sign(d)!==Math.sign(i))&&(r=!!(_.length&&_.scrollTop()<=3),o=!!(_.length&&p.scrollTop()>=p.prop("scrollHeight")-p.innerHeight()-1)),h===e&&u<t&&(t=u+100);var g=Math.abs(d)-Math.abs(i);if(i=d,u>t||g>0)e=h,t=u+100,n=!!(p.hasClass("lmt__scrollable")&&h.scrollHeight>h.clientHeight);else if(h!==e)return t=u+100,!n&&!p.hasClass("lmt__scrollable")||L(l);if(n){var m=p.scrollTop(),v=p.prop("scrollHeight"),T=p.innerHeight(),y=!0;return d<0&&-d>v-T-m&&!o?(p.scrollTop(v),y=L(l)):d>0&&d>m&&!r&&(p.scrollTop(0),y=L(l)),y}return!0})}();var rn=t.createValueWrapper(!1);!function(){var e=0;J(we,function(t){++e,rn(!0),1==e&&(ne.addClass("lmt__busy_indicator--active"),a(".lmt__translations_as_text .lmt__busy_indicator").addClass("lmt__busy_indicator--active"))}),J(xe,function(t){0==--e&&(ne.removeClass("lmt__busy_indicator--active"),a(".lmt__translations_as_text .lmt__busy_indicator").removeClass("lmt__busy_indicator--active"),rn(!1))})}();var on=t.createValueWrapper(!0);J(Le,function(e){S(!0),0==X.val().length?(on(!0),Y(Re)):on(!1)});var sn=/[\x00-\x08\x0B-\x1f\x7F\xAD]/g;J(Le,function(t){var n="[splitting]",a=t.state,i=X.val();if(i.match(sn))return i=i.replace(sn,""),ae(n,"Invalid characters detected and removed."),X.val(i),void Y(Le,t);Y(we,"translateRequest"),t.onRequestEnded.push(function(){Y(xe,"translateRequest")});var r,o={lang_user_selected:Qe.selectedSourceLang,user_preferred_langs:Qe.getPreferredLangs()},s=Qe.selectedSourceLang,l=Qe.getSelectedTargetLang(),u=[],d=[],h=[];H("sentenceSplitting"+a[Fe],function(){return new Promise(function(s,l){var _=i.substr(0,ue);if(Ue[qe]()){var p=_.match(/\s*.+(\n|$)/);p&&(_=p[0])}r=_;var f=!1,m=/\s+/g,v=[];if(_.split(/(?:\s*\n)+\s*/g).forEach(function(e){var t=e.replace(m," ").trim();t.length>14e3&&(f=!0),t.length&&v.push(t)}),f)l(function(e){return{errorType:e}}("LMT_ERROR_TYPE__LINE_TOO_LONG_TO_SPLIT"));else{for(var T=0,y=0,b=0;a[He][T]&&void 0!==v[y];){for(var w=v[y],x=[];w.length;){if(!(S=a[He][T]))break;L=S[ot].replace(m," ");if(x.push(L),!w.startsWith(L))break;ae(n,"Sentence matched"),w=w.substr(L.length).trim(),++T}if(w.length){ae(n,"change found",T,y);break}ae(n,"paragraph consumed"),b+=v[y].length,u.push(x),++y}b>0&&b<500&&(b=0,u.splice(0));for(var C=a[He].length-1,E=v.length-1;a[He][C]&&void 0!==v[y]&&C>T&&E>y;){for(var w=v[E],x=[];w.length;){var S=a[He][C];if(!S)break;var L=S[ot].replace(m," ");if(x.unshift(L),!w.endsWith(L))break;w=w.substr(0,w.length-L.length).trim(),--C}if(w.length)break;d.unshift(x),--E}var R=0;if((h=v.slice(u.length,v.length-d.length)).forEach(function(e){R+=e.length}),R>0)for(var k=0;R<500;)if(k=1-k)if(u.length){O=u.pop().join(" ");h.unshift(O),R+=O.length}else{if(!d.length)break;O=d.shift().join(" ");h.push(O),R+=O.length}else if(d.length){O=d.shift().join(" ");h.push(O),R+=O.length}else{if(!u.length)break;var O=u.pop().join(" ");h.unshift(O),R+=O.length}(function(t,n,a,i){return new Promise(function(r,o){function s(t){if(h.length){var a=h[0];l&&ae("[sentenceSplitting] BATCH:",a),Dt({texts:a,lang:n}).then(function(e){h.shift(),Y(Ee,"splitting"),e.splitted_texts.forEach(function(e){_.splittedTextblocks[d[p]]=e,++p}),void 0===_.detectedLang&&(_.detectedLang=e.lang,_.langIsConfident=e.lang_is_confident,_.splitSentenceRequestUsed=!0),s()},function(n){Y(Se,"splitting",n);var a=t||0;if(console.warn("[sentenceSplitting] Error during splitting request (retryNr "+a+": ",n),a>=3||n&&n.errorType===e.ErrorTypes.REQUEST_FAILED&&n.data&&403===n.data.status)o(g(n,"splitting"));else{var i=3e3+5e3*a;console.log("[sentenceSplitting] Trying again in "+i+"ms!"),setTimeout(function(){s(a+1)},i)}})}else r(_)}var l=!1;l&&ae("[sentenceSplitting] Request.",t);var u=[],d=[],_={splittedTextblocks:[],detectedLang:void 0,langIsConfident:void 0,splitSentenceRequestUsed:void 0};if(t.forEach(function(e,t){i||e.length>=200||e.match(At)||a==re||a==oe?(u.push(e),d.push(t)):_.splittedTextblocks[t]=[e]}),l&&ae("[sentenceSplitting] textblocksToRequest.",u),u.length){var h=c(u,_e,function(e){return e.length});l&&ae("[sentenceSplitting] Request batches:",JSON.stringify(h));var p=0;s()}else l&&ae("[sentenceSplitting] Only one sentence."),splitSentenceRequestUsed=!1,setTimeout(function(){r(_)})})})(h,o,t.initialTrigger,Ue[Pe]()).then(s,l)}})},5e3).then(function(e){if(s!=Qe.selectedSourceLang||l!=Qe.getSelectedTargetLang())return ae("IGNORED response from sentenceSplitting because selectedSourceLang, selectedTargetLang."),void t.onRequestEnded();var i=u.concat(e.splittedTextblocks,d),o=e.detectedLang,c=e.langIsConfident;if(t.initialTrigger==re&&"auto"!=Qe.selectedSourceLang&&o!=Qe.selectedSourceLang)return ae("[sentenceSplitting] IGNORING response from sentenceSplitting because source lang switched by server."),void t.onRequestEnded();""!=o&&void 0!==o&&(ae("[sentenceSplitting] pushPreferredLang("+o+")"),c&&Qe.pushPreferredLang(o));var h=0;u.forEach(function(e){e.forEach(function(e){h+=e.length})}),o&&o!=a[$e]&&(h>500?ae(n,"[sentenceSplitting] (Ignoring; Too much text in front) Different source lang detected ",a[$e],"->",o):(ae(n,"[sentenceSplitting] Source lang changed ",a[$e],"->",o),_.switchSourceLang(o)));var p=[];i.forEach(function(e){e.forEach(function(e){p.push(e.trim())})}),a!=Ve&&(t.onRequestEnded(),t=new R(Ve,t.initialTrigger)),t.splitSentenceRequestUsed=!!e.splitSentenceRequestUsed,t.sourceLangHasBeenDetermined=!!o,Y("ON__NEW_SOURCE_SENTENCE_SPLITTING_RECEIVED",t,p,r)},function(e){if(t.onRequestEnded(),e===H.FAILURE_REASON__CANCELED);else{var a=e;"LMT_ERROR_TYPE__LINE_TOO_LONG_TO_SPLIT"===a.errorType?(console.warn(n,"Too long line detected"),Y("ON__TOO_LONG_LINE_IN_SOURCE_DETECTED")):(Y(Ce,"splitting",a),console.error(a))}})}),J("ON__TOO_LONG_LINE_IN_SOURCE_DETECTED",function(){var e=[],t=["! ","? ",": ","; ",". ",", ",'" '," "];X.val().split("\n").forEach(function(n){for(;;){if(n.length<14e3){e.push(n);break}console.log("[lineSplit]","Split long line",n.length);for(var a=n.length,i=!1,r=0;r<t.length;++r){var o=n.indexOf(t[r],10500);if(o>=0&&o<14e3){e.push(n.substr(0,o+1).trimEnd()),n="   "+n.substr(o+t[r].length).trimStart(),i=!0;break}}if(i||(e.push(n.substr(0,10500).trimEnd()),n="   "+n.substr(10500).trimStart()),n.length>=a)throw new Error("Sanity check failed!")}}),X.val(e.join("\n")),Y(Le,new R(Ve,se))}),J(Re,function(){Ue[Pe](!1)});var ln=/^\s*/g,cn=/^((\s*$)|(\s*?\n)|( ?)(?= +))/g,un=/\s*$/,dn=/(?:^|\S)(?:\s*?\n| ?(?= ))(\s*)$/;J("ON__NEW_SOURCE_SENTENCE_SPLITTING_RECEIVED",function(e,t,n){function a(e){return e&&e[nt]&&e[nt][ze]}var i=e.state,r=i[He],o=r.splice(0);if(t){for(var s=t.slice(0),l=n;s.length&&o.length&&a(o[0])===s[0];){f=o.shift();r.push(f);var c=s.shift(),u=l.match(ln)[0];if(f.setWhitespacesBefore(u),u.length&&(l=l.substr(u.length)),l.startsWith(c))f[ot]=c,l=l.substr(c.length);else{var d=c.replace(/\s/g,""),_=new RegExp("^(\\s*\\S){"+d.length+"}");(v=l.match(_))?(f[ot]=v[0].trim(),l=l.substr(v[0].length)):(f[ot]=c,console.warn("[_updateSourceSentencesData] Could not consume source sentence text!"),console.log("["+c+"]"),console.log("["+l+"]"))}(v=l.match(cn))&&v[0].length?(f.setWhitespacesAfter(v[0]),l=l.substr(v[0].length)):f.setWhitespacesAfter("")}for(var h=[];s.length&&o.length&&a(o[o.length-1])===s[s.length-1];){var f=o.pop(),g=s.pop();h.unshift(f);var m=l.match(un)[0];if(f.setWhitespacesAfter(m),m.length&&(l=l.substr(0,l.length-m.length)),l.endsWith(g))f[ot]=g,l=l.substr(0,l.length-g.length);else{var d=g.replace(/\s/g,""),_=new RegExp("(\\S(\\s*\\S){"+(d.length-1)+"})$");(v=l.match(_))?(f[ot]=v[0].trim(),l=l.substr(0,l.length-v[0].length)):(console.warn("[_updateSourceSentencesData] (back) Could not consume source sentence text!"),console.log("["+g+"]"),console.log("["+l+"]"))}var v=l.match(dn);v?(f.setWhitespacesBefore(v[1]),l=l.substr(0,l.length-v[1].length)):f.setWhitespacesBefore("")}for(s.forEach(function(e){var t=i[We][e];void 0===t&&(t=new function(e){this[ze]=e,this[Ke]=Ae++,this[Xe]=new Object(null),this[Ze]=new Object(null),this[et]=void 0}(e),i[We][e]=t);var n=new p(t);if(o.length){var a=o.shift(),s=a[at]?a[at].slice(0):[];s.unshift(a[nt]);for(var c=[];s.length;){var u=s.shift();if(c.push(u),u[Je])break}n[at]=c}var d=l.match(ln)[0];if(n.setWhitespacesBefore(d),d.length&&(l=l.substr(d.length)),l.startsWith(e))n[ot]=e,l=l.substr(e.length);else{var _=e.replace(/\s/g,""),h=new RegExp("^(\\s*\\S){"+_.length+"}");(f=l.match(h))?(n[ot]=f[0].trim(),l=l.substr(f[0].length)):(console.warn("[_updateSourceSentencesData] Could not consume source sentence text!"),console.log("["+e+"]"),console.log("["+l+"]"))}var f=l.match(cn);f?(n.setWhitespacesAfter(f[0]),l=l.substr(f[0].length)):n.setWhitespacesAfter(""),r.push(n)});h.length;)r.push(h.shift())}Y("ON__SOURCE_SENTENCES_CHANGED",e)}),function(){function e(e,i){var r=e.state,o=[];ae(a,"doUpdateInitialTranslation",e,i);var s;H("initialTranslation"+r[Fe],function(){return Y(we,"initialTranslationRequest",e),e.onRequestEnded.push(function(){Y(xe,"initialTranslationRequest")}),new Promise(function(l,u){function d(t){var i=t.currentBatchId(),c=t.getCurrentResult();if(n&&ae(a,"Handeling batch",i),r!==Ve)return ae(a,"State changed -> cancel translation handling."),e.onRequestEnded(),void l();if(!c)return ae(a,"Empty request"),Y(Te,e),void l();var u=c[Ot],p=c[Nt];if(u===r[$e]&&p===r[Ge]||(ae(a,"Response language do not match request."),ae(a,"receivedSourceLang:",u),ae(a,"STATE__SOURCE_LANG:",r[$e]),ae(a,"receivedTargetLang:",p),ae(a,"STATE__TARGET_LANG:",r[Ge])),0===i){if(e.initialTrigger==re&&"auto"!=Qe.selectedSourceLang&&u!=Qe.selectedSourceLang)return ae(a,"IGNORING result because source lang switched by server on initialTranslation."),e.onRequestEnded(),void l();if(e.sourceLangHasBeenDetermined&&u&&u!==Ve[$e]&&(console.warn("BUG in Scheduler. Source language has been determined and cannot be changed. receivedSourceLang="+u+" "),u=Ve[$e]),u&&(n&&ae(a,"pushPreferredLang("+u+")"),c.source_lang_is_confident&&Qe.pushPreferredLang(u)),u&&r[$e]!==u||p&&r[Ge]!==p)return ae(a,"Switching lang codes to ",u,p),e.onRequestEnded(),!Ue[Pe]()&&!e.splitSentenceRequestUsed&&r[He].length>1?Ue[Pe](!0):_.switchLangCodes(u,p),setTimeout(function(){Y(Le,new R(Ve,e.initialTrigger))}),void l()}var f=c[kt],v=!1;f.forEach(function(e){var t=o[g];if(++g,e.beams.length){var n=[];e.beams.forEach(function(e){var t=e[Rt];n.some(function(e){return e===t})||n.push(t)}),t[Je]=n.shift(),t[et]=e,t[Ye]=n}else t[Je]=ie?"[SENTENCE COULD NOT BE TRANSLATED]":"",v=!0}),v&&(console.warn(a,"Empty beams!"),console.warn(a,"Jobs:",s),console.warn(a,"Result:",c)),f.length<t.getNumberOfJobsInCurrentBatch()?(ae(a,"Finished with errors: Partial result!"),t.stopped(!0),Y(be),l()):f.length!=t.getNumberOfJobsInCurrentBatch()?(ae(a,"Finished with errors: Invalid number of results",f.length,t.getNumberOfJobsInCurrentBatch()),t.stopped(!0),Y(Ce,"translation",m("Invalid result.")),l()):t.finished()?l():(n&&ae(a,"Next..."),t.next().then(d,h))}function h(t){e.onRequestEnded(),f.stopped(!0),Y(Ce,"translation",t),i<0?u(t):(n&&ae(a,"Finished with errors"),l())}if(r===Ve){if(ae(a,"Collecting translation jobs...",e),s=[],(Ue[qe]()?r[He].slice(0,1):r[He]).forEach(function(e){var t=e[nt];void 0===t[Je]&&(s.push({kind:Et,raw_en_sentence:t[ze]}),o.push(t))}),!s.length)return n&&ae(a,"No requests necessary."),Y(Te,e),void l();var p={user_preferred_langs:Qe.getPreferredLangs()};e.sourceLangHasBeenDetermined?p.source_lang_computed=Ve[$e]:p.source_lang_user_selected=Qe.selectedSourceLang,p.target_lang=Qe.getSelectedTargetLang(),n&&ae(a,"[_requestInitialTranslations] Schedule initialTranslation"),i<1&&s.length>1&&(i=1,ae(a,"Increase priority for large request"));var f=function(e,n,a,i,r){var o,s=c(n,r,function(e){return JSON.stringify(e).length}),l=0,u=0,d=[],_=t.createValueWrapper(-1),h=t.createValueWrapper(!1),p=t.createValueWrapper(!1);s.forEach(function(e){var t=v(e,a),n=0;It[t]||++l,e.forEach(function(e){n+=e.raw_en_sentence.length}),u+=n,d.push(n)});var f={currentBatchId:_,getCurrentResult:function(){return o},getNumberOfJobsInCurrentBatch:function(){return s[_()].length},next:function(){return new Promise(function(e,t){f.finished()?t(m("Already finished!")):(_(_()+1),T(0,s[_()],a,i,i>0).then(function(t){f.numRemainingCharacters(f.numRemainingCharacters()-d[_()]),o=t,(_()>=s.length-1||h())&&p(!0),e(f)},function(e){h(!0),p(!0),t(e)}))})},finished:p,stopped:h,numCharactersToTranslate:t.createValueWrapper(u),numRemainingCharacters:t.createValueWrapper(u),numNotCachedBatchesToTranslate:t.createValueWrapper(l)};return f}(0,s,p,i,he),g=0;Y(me,f,e),f.next().then(d,h)}else u(H.FAILURE_REASON__CANCELED)})},1e4).then(function(t){n&&ae(a,"Finished"),Y(Te,e)},function(t){t===H.FAILURE_REASON__CANCELED?ae(a,"CANCELED (ignore...)"):i<0?(console.warn(t),ae(a,"Low-prio request failed."),Ue[Ie]=Date.now()+le,Y(we,"backupTranslateRequest"),setTimeout(function(){Y(xe,"backupTranslateRequest")},ce+50),j("assureInitialTranslationIsRequested",function(){ae(a,"Send backup request"),Y(Le,new R(Ve,se))},ce)):console.error(t),e.onRequestEnded()})}var n=!0,a="[updateInitialTranslation]";J("ON__SOURCE_SENTENCES_CHANGED",function(t){var i=t.state;n&&ae(a,"ON__SOURCE_SENTENCES_CHANGED",i[$e],i[Ge],t.initialTrigger),t[en](),e(t,"source_text_changed_by_typing"===t.initialTrigger?-1:1)})}(),J(Te,function(e){function n(e){var t=e.getSourceSentence(),n=t[nt];if(t[st]>=e[vt]){var a=[];t[lt]>e[Tt]?(a.push(t[it]),e[Tt]=t[lt]):a.push(e.getWhitespacesBefore());var i=n[Je];if(void 0===i){e[vt]=-1;for(var r=t[at]?t[at].slice(0):[];;){var o=r.shift();if(!o){Ue[qe]()||a.length&&"[...] "===a[a.length-1]||a.push("[...] ");break}if(o[Je]){a.push(o[Je]);break}}}else e[vt]=t[st],a.push(i);t[ct]>e[yt]?(a.push(t[rt]),e[yt]=t[ct]):a.push(e.getWhitespacesAfter()),e.setText(a.join(""),void 0!==i)}else t[lt]>e[Tt]&&(e[Tt]=t[lt],e[ut]=t[it]+e[ut].trimStart(),e[ht]=void 0,m&&ae("[updateTarget] update whitespaces before ","["+t[it]+"]")),t[ct]>e[yt]&&(e[yt]=t[ct],e[ut]=e[ut].trimEnd()+t[rt],e[ht]=void 0,m&&ae("[updateTarget] update whitespaces after ","["+t[rt]+"]")),m&&ae("[updateTarget] target preserved ","["+e[ut]+"]")}function r(e,n){a("<div></div>").css({display:"inline-block",width:"25px",height:"10px"}).appendTo(e),a("<div class='lmt__translations_as_text__copy_button'><div></div></div>").click(function(){var i=a(this);i.addClass("lmt__translations_as_text__copy_button--active"),setTimeout(function(){i.removeClass("lmt__translations_as_text__copy_button--active")},100);var r=t.createValueWrapper(n);Y(ye,r),function(e,t){navigator.clipboard&&navigator.clipboard.writeText?(ae("Use clipboard api!"),navigator.clipboard.writeText(e)):new Promise(function(n,i){var r=a("<textarea id='tmp'></textarea>").css({position:"absolute",opacity:0,left:0,width:"100px"}).appendTo(t||a("body")).val(e);setTimeout(function(){r.remove()},1e3),u(r).then(function(e){r.remove(),n(e)},function(e){r.remove(),i(e)})})}(r(),e)}).appendTo(e)}function s(e,t,n){e=e.trim();var i=t&&e.length>0,o=a("<span></span>").text(e),s=a("<p></p>").append(o).appendTo(ee);n&&s.addClass("lmt__translations_as_text__main_translation"),i&&r(s,e)}m=!1;m&&ae("[updateTarget] ON__INITIAL_SOURCE_TRANSLATION_UPDATED");v=e.state;if(e.onRequestEnded(),K.CONFIG__UPDATE_TARGET_SENTENCES){for(var l=v[He].slice(0),c=v[je].splice(0),d=v[je];c.length&&c[0].getSourceSentence()===l[0];){m&&ae("[updateTarget] consume front");n(p=c.shift()),d.push(p),l.shift()}for(var _=[];c.length&&c[c.length-1].getSourceSentence()===l[l.length-1];){m&&ae("[updateTarget] consume back");n(p=c.pop()),_.unshift(p),l.pop()}for(;l.length&&c.length;){m&&ae("[updateTarget] assign");R=l.shift();(p=c.shift()).setSourceSentence(R),n(p),d.push(p)}for(;l.length;){m&&ae("[updateTarget] add new");R=l.shift();(p=new f("")).setSourceSentence(R),n(p),d.push(p)}for(;c.length;)c.shift(),m&&ae("[updateTarget] remove");for(;_.length;){var p=_.shift();d.push(p)}var g=[];d.forEach(function(e){g.push(e[ut])}),v[Be]=g.join("")}else{y=[];(Ue[qe]()?v[He].slice(0,1):v[He]).forEach(function(e,t){y.push(e[it]);var n=e[nt][Je];if(void 0===n)for(var a=e[at]?e[at].slice(0):[];;){var i=a.shift();if(!i){y.length&&"... "===y[y.length-1]||y.push("... ");break}if(i[Je]){y.push(i[Je]);break}}else y.push(n);y.push(e[rt])});b=y.join("");v[Be]=b;d=[];v[He].forEach(function(e){var t=new f(e[it]+(e[nt][Je]||"")+e[rt]);t.setSourceSentence(e),d.push(t)}),v[je]=d}if("auto"==Ln.attr("dl-displayed")&&""!=v[Be]&&(console.log("Restoring source language."),F(Ln,Qe.sourceLang)),v===Ve){var m;(m=!1)&&ae("[MobileResult] translation received",ee);var v=e.state;ee.empty().html("<div class='lmt__busy_indicator'></div>").css("font",X.css("font")).css("font-size",X.css("font-size"));var T=!1,y=[];(Ue[qe]()?v[He].slice(0,1):v[He]).forEach(function(e,t){y.push(e[it]);var n=v[je][t][ut];if(!n){n=e[nt][Je]}if(void 0===n){T=!0;for(var a=e[at]?e[at].slice(0):[];;){var i=a.shift();if(!i){y.length&&"... "===y[y.length-1]||y.push("... ");break}if(i[Je]){y.push(i[Je]);break}}}else y.push(n);y.push(e[rt])});var b;s(b=y.join("").trim(),!T,!0);var w=b.toLowerCase().replace(new RegExp("[!?\\.,]","g"),""),x=[w],C=0,L=window.width>800?45:30;if(1==v[He].length&&!T&&!e[tn]){var R=v[He][0],k=0;"EN"!=v[$e]&&"EN"!=v[Ge]&&(k=5);var O=R[ot].length;if(m&&ae("[updateTarget] Sentence length:",O),O<=60&&O>=k&&R[nt][Ye]){R[nt][Ye].forEach(function(e){if((3!=C||dl.isMobilePhone)&&(e=e.trim(),m&&ae("[updateTarget] Alternative Translation length: ",e.length),!(e.length>L)&&(w=e.toLowerCase().toLowerCase().replace(new RegExp("[!?\\.,]","g"),""),e.length))){var t=w.split(" "),n=-1!==x.indexOf(w);n||t.forEach(function(e,a){e.length>2&&t.forEach(function(t,i){t.startsWith(e)&&a!=i&&(n=!0)})}),n||(s(e,!0,!1),C++,x.push(w))}})}}C>0?(a("<h2></h2>").text(h("alternativeTranslations","Alternatives:")).prependTo(ee),void 0===i.without_alternatives&&(o.addClass("lmt__translator--showing_alternatives"),o.find(".lmt__sides_container").css("overflow","hidden"),setTimeout(function(){o.find(".lmt__sides_container").css("overflow","")},400))):o.removeClass("lmt__translator--showing_alternatives"),m&&ae("[updateTarget] Alternative initial translations:",C)}v===Ve&&(Z.val(v[Be]),nn("update"),S(!1)),K.CONFIG__SHOW_ALTERNATIVES&&1==v[je].length&&j("alternativesPopup",function(){if(v===Ve&&1==v[je].length){var e=v[je][0],t=e.getTranslation();if(t&&t[Ye]){if(!(E(e[ut].length).top>parseInt(Z.css("padding-top"))+parseInt(Z.css("line-height")))){var n=[];if(t[Ye].forEach(function(e){n.push({postfix:e,displayPostfix:e})}),n.length){var a=new q;a[fn]=e,a[mn]=0,a[gn]=0,a[vn]=!1,a[Tn]=!1,a[yn]=n,a[bn]="initialAlternatives",wn.update(v,a)}}}}},500),wn.close(v),t.notify("LMT/translationReady",X.val(),Z.val(),Qe.sourceLang,Qe.targetLang)});var _n=/[\s.,:;!?"\(\)*]/,hn=/[^\s.,:;!?"\(\)*]/;!function(){function e(e,n){if(te.hasClass("lmt__edit_text_popup--visible"))wn.close();else{var a=Ve,i=Z.val();b(a,i);var r=w(),o=Z.prop("selectionEnd");if(-1==i.substr(r,o-r).trim().indexOf(" ")){var s=r;if(i.charAt(s).match(hn))for(;s>0&&i.charAt(s-1).match(hn);)--s;var l=x(a,s);if(l){if(0==i.substr(Math.max(0,r-1),o-r+2).trim().length&&l.sentence[ut].trim().length)return void(t&&ae("[processClickEvent] Clicked in empty area."));var c=E(r),u=E(s),d=r===o?u:E(o);if(u.top<=0&&u.left<=0&&s>0)return void ae("[processClickEvent] Unable to detect pixel position at offset ",s);if(c.left<u.left-2)l.caretAtNextLine=!0,t&&ae("[processClickEvent] pixelOffset_before",c,"pixelOffset",u);else{t&&ae("[processClickEvent] ["+i.charAt(r-1)+i.charAt(r)+i.charAt(r+1)+"]");var _=E(r+1),h=parseInt(Z.css("padding-left")),p=parseInt(Z.css("line-height"));(u.top<d.top&&"\n"!==i.charAt(r-1)||e<=h&&"\n"!==i.charAt(r-1)||e<_.left&&u.top<_.top)&&s>0&&s<i.length-1?l.caretAtNextLine=!0:s>=i.length-1&&n>u.top+p&&(l=void 0)}}t&&ae("[processClickEvent] Click on sentence:",r,s,l),Y(ve,a,l)}else wn.close()}}var t=!1;if((navigator.vendor||"").match(/google/i))Z.on("click",function(t){e(t.offsetX,t.offsetY)});else{var n=0;Z.on("click",function(t){var a=Date.now();if(!dl.isIPad||n<a){n=a+50;var i=t.offsetX,r=t.offsetY;setTimeout(function(){e(i,r)})}}),dl.isIPad&&Z.on("touchend",function(t){function a(){--l<0||s!=w()?e(r,o):setTimeout(a,25)}if(t.originalEvent.targetTouches&&!t.originalEvent.targetTouches.length&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches.length){var i=Date.now();if(n<i){if(n=i+50,ae("ipad touch-click"),wn.isOpen())return wn.close(),L(t);var r=t.layerX,o=t.layerY,s=w(),l=4;setTimeout(a,100)}}})}}();var pn;J(ve,function(e,t){if(Ue[Me]())wn.close();else if(void 0===t)e===Ve&&wn.close();else{var n=new q;n[fn]=t.sentence,n[mn]=t.cursorOffset,n[gn]=t.sentenceCursorOffset,n[vn]=t.caretAtNextLine,e===Ve&&(n[Tn]=!0,Y(we,"clickPopupRequest"),pn=setTimeout(function(){wn.update(e,n)},50),function(e,t){var n=!1,a="[requestAlternativesForPopup]";return new Promise(function(i,r){function o(e){var t=[];return n&&ae(a,"existingPostfix:",f),e.forEach(function(e){var n=e.postfix;n.trim().length&&!f.startsWith(n)&&t.push(e)}),t}var s=t[fn];if(void 0!==t[fn]&&e===Ve){var l=s.getTranslation();if(!l)return n&&ae(a," No Translation object."),void r(new O);n&&ae(a,"THE TEXT ["+s[ut]+"]","offset:",t[gn],"["+s[ut].substr(0,t[gn])+"]");var c=s.getNormalizedTextAndOffset(t[gn]),u=c[0],d=c[1],h=u.substr(0,d),p=h.length,f=u.substr(d);if(n&&ae(a,"THE PREFIX ["+h+"]","normalizedOffset:",d),0==f.trim().length&&s[gt].length>3&&h.trim().substr(h.trim().length-5)===s[gt].substr(s[gt].length-5))return n&&ae(a,"Don't update popup behind sentence"),void i([]);if(l[Ze][h])return n&&ae(a,"Already requested."),void i(o(l[Ze][h]));n&&ae(a,"["+l[ze]+"]->["+h+"]"),T(0,[{kind:Lt,de_sentence_beginning:h,raw_en_sentence:l[ze]}],_.getLangConfigForTranslation(),1,!1).then(function(e){Y(Ee,"alternatives");var t=[];(((e[kt]||[])[0]||[]).beams||[]).forEach(function(e){var n=e[Rt].substr(0,p);if(h.trim()!==n.trim())console.warn(a,"Prefix does not match\nreceived ["+n+"]\n expected ["+h+"]");else{var i=e[Rt].substr(p);t.push({displayPostfix:i+" ...",postfix:i})}}),l[Ze][h]=t,i(o(t))},function(e){Y(Ce,"alternatives",e),r(e)})}else r(new O)})}(e,n).then(function(t){Y(xe,"clickPopupRequest"),clearTimeout(pn),n[Tn]=!1,n[yn]=t,wn.update(e,n)},function(e){Y(xe,"clickPopupRequest"),wn.close(),function(e){console.warn("================","\n",e)}(e)}))}}),function(){var e;Z.on("keydown",function(t){var n={keyUpHandler:void 0,suppressKeyUpEvent:!1,keyDownEvent:t};e=n,Y("ON__TARGET_EDIT_KEY_DOWN",t,n)}),Z.on("keyup",function(t){var n;if((n=e&&t.keyCode===e.keyDownEvent.keyCode?e:new Object(null)).keyUpHandler)return n.keyUpHandler(t);n.suppressKeyUpEvent||Y("ON__TARGET_EDIT_KEY_UP",t,n)})}();var fn="popupSentence",gn="popupSentenceCursor",mn="popupCursor",vn="nextLineCursor",Tn="waitingIndicator",yn="entries",bn="isAc",wn=function(){function e(e){var t=te.offset(),n=t.top-window.scrollY,i=parseInt(Z.css("line-height")),o=t.left+te.outerWidth();te.css("max-height",Math.min(10*i,Math.max(a(window).height()-n-4,3*i))),t.left>a(window).width()-o?r.position({top:t.top+te.height()/2,left:t.left},"right"):r.position({top:t.top+te.height()/2,right:t.left},"left")}function t(){var e=new q;e[fn]=void 0,wn.update(Ve,e),r.hide(250),Y(Oe)}function n(){return te.hasClass("lmt__edit_text_popup--visible")}function i(e){if(te.find(".lmt__edit_text_popup__entry--active").removeClass("lmt__edit_text_popup__entry--active"),e.addClass("lmt__edit_text_popup__entry--active"),e.length){var t=e.position(),n=te.height(),a=e.height();t.top<=a?(s=Date.now()+250,te.scrollTop(te.scrollTop()+t.top-a)):t.top>=n-3*a&&(s=Date.now()+250,te.scrollTop(te.scrollTop()+t.top-(n-3*a)))}}var r=$t.create("completionHint",h("translator/messageBox_completionHint","Choose a word and DeepL will finish the sentence for you."));r.maximalDisplayCount(10),r.disable(dl.isMobilePhone);var s=0;return a(window).resize(function(){e()}),X.on("focus",function(){t(),r.hide(250)}),Z.on("focus",function(){ee.html("<div class='lmt__busy_indicator'></div>"),o.removeClass("lmt__translator--showing_alternatives"),S(!1)}),Z.parent().on("scroll",function(){t()}),a("body").on("click",function(e){a(e.target).closest(".lmt__edit_text_popup").length||a(e.target).closest(".lmt__target_textarea").length||t()}),dl.isIPad&&a("body").on("touchend",function(e){if(e.originalEvent.targetTouches&&!e.originalEvent.targetTouches.length&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length){e.originalEvent.changedTouches[0].target;a(e.target).closest(".lmt__edit_text_popup").length||a(e.target).closest(".lmt__target_textarea").length||(ae("[popup] close by touch"),t())}}),J("ON__TARGET_EDIT_KEY_DOWN",function(e,a){var r=!1;if(n()){if(e.keyCode===Cn)a.suppressKeyUpEvent=!0,t();else if(e.keyCode===Sn){if((l=te.find(".lmt__edit_text_popup__entry--active")).length){var o=l.next("li");o.length&&i(o)}else te.find("li").first().addClass("lmt__edit_text_popup__entry--active");r=!0}else if(e.keyCode===En){if((l=te.find(".lmt__edit_text_popup__entry--active")).length){var s=l.prev("li");s.length?i(s):t(),r=!0}else t()}else if(e.keyCode===xn){var l=te.find(".lmt__edit_text_popup__entry--active");l.length&&l.click(),t(),r=!0}else t();r&&(L(e),a.keyUpHandler=function(e){return L(e)},a.suppressKeyUpEvent=!0)}}),{messageBox:r,update:function(n,i){var o=[];if(void 0!==i[fn]&&n===Ve){var l=i[gn],c=i[fn],u="autocompletion"==i[bn],d="initialAlternatives"==i[bn],_="alternatives"==i[bn];if(i[Tn])te.empty().append("<div class='lmt__edit_text_popup__waiting_indicator'>...</div>");else{if(!(o=i[yn]||[]).length)return console.warn("[updatePopup]: no Translations for target sentence."),void te.removeClass("lmt__edit_text_popup--visible");var h=c[ut].substr(0,l),p=a("<ul></ul>"),f={};o.forEach(function(e){var o=P(e.displayPostfix,Qe.targetLang);f[o]||(f[o]=!0,a("<li></li>").text(o).on("mouseenter",function(){Date.now()>s&&(te.find(".lmt__edit_text_popup__entry--active").removeClass("lmt__edit_text_popup__entry--active"),a(this).addClass("lmt__edit_text_popup__entry--active"))}).on("mouseleave",function(){d&&a(this).removeClass("lmt__edit_text_popup__entry--active")}).appendTo(p).on("click",function(a){window.getSelection().isCollapsed&&(t(),I(n,c,h,e.postfix,!u).then(function(){var t=i[mn]+e.postfix.length;Z[0].setSelectionRange(t,t)},function(e){Y(Ce,"fillUp",e)}),r.disable(!0))}))}),te.empty().append(p)}u&&te.addClass("lmt__edit_text_popup--autocompletion").removeClass("lmt__edit_text_popup--initial_alternatives").removeClass("lmt__edit_text_popup--alternatives"),d&&te.removeClass("lmt__edit_text_popup--autocompletion").addClass("lmt__edit_text_popup--initial_alternatives").removeClass("lmt__edit_text_popup--alternatives"),_&&te.removeClass("lmt__edit_text_popup--autocompletion").removeClass("lmt__edit_text_popup--initial_alternatives").addClass("lmt__edit_text_popup--alternatives");var g=parseInt(Z.parent().css("font-size"));te.css("font-size",g<18?g+"px":""),te.addClass("lmt__edit_text_popup--visible");var m=parseInt(Z.css("line-height")),v=E(i[mn]);i[vn]&&(v.left=parseInt(Z.css("padding-left")),v.top+=m),v.left-=4,v.top=Math.round(v.top),v.left=Math.round(v.left);var T=te.offsetParent().offset(),y=Z.offset();v.top+=y.top-T.top,v.left+=y.left-T.left;var b=m,w=v.top+b,x=v.left,C=te.outerWidth(),S=window.scrollX||0;x+C>a(window).width()+S-T.left-10&&(x=a(window).width()+S-T.left-C-10),te.scrollTop(0),te.css("transform","translate("+x+"px,"+w+"px)"),e(),o.length>1&&"alternatives"==i[bn]&&r.show(250),Y(ke,i)}else te.removeClass("lmt__edit_text_popup--visible")},close:t,isOpen:n}}(),xn=13,Cn=27,En=38,Sn=40;J("ON__TARGET_EDIT_KEY_UP",function(e,n){32===e.keyCode?U():37===e.keyCode||39===e.keyCode||36===e.keyCode||35===e.keyCode||e.keyCode===Sn||e.keyCode===En?(wn.close(),j("triggerAlternativePopup",function(){if(document.activeElement==Z[0]){var e=w(),t=Z.val().charAt(e-1),n=Z.val().charAt(e);0!=e&&"\n"!==t&&" "!==t||" "===n||"\n"===n||U()}},300)):e.keyCode>=15&&e.keyCode<32||224===e.keyCode||33===e.keyCode||34===e.keyCode||(b(Ve,Z.val()),Ue[Me]()||e.keyCode===xn||91===e.keyCode||92===e.keyCode||93===e.keyCode||(46===e.keyCode||8==e.keyCode)&&Z.val().charAt(w())<" "||function(){var e,n,a,i="[autocompletion]",r=Ve,o=t.createCallOnce();H("onKeyRequest_"+r[Fe],function(){return new Promise(function(t,s){if(r!==Ve)return ae(i,"Outdated."),void s(new O);n=w();var l=x(r,n);if(!l)return ae(i,"No aligned sentence found."),void s(new O);Y(we,"autocompletion"),o.push(function(){Y(xe,"autocompletion")}),e=l.sentence;var c=l.sentenceCursorOffset,u=e.getNormalizedTextAndOffset(c),d=u[0],h=u[1];a=d.substr(0,h);var p=e.getTranslation();if(e[gt]&&a.startsWith(e[gt].trim()))t([]);else{var f,g=e[mt].slice(0),m=e.getTranslation()[et];if(m){var v=new Object(null);v[kt]=[m],g.push(["",e.getTranslation()[Je],v])}g.some(function(e){var t=e[0],n=e[1],i=e[2];if(a.startsWith(t)&&n.startsWith(a))return f=i,!0}),f?t(f):T(0,[{kind:St,de_sentence_beginning:a,raw_en_sentence:p[ze]}],_.getLangConfigForTranslation(),1,!1).then(function(e){Y(Ee,"autocomplete"),t(e)},s)}})},1e3).then(function(t){o();var s=x(r,n);if(s&&s.sentence===e){if(ae("[autcompletion] Results:",t),g=[],!s)return void ae(i,"No aligned sentence found.");var l="",c=e[ut],u=s.sentenceCursorOffset;if(u>0)for(--u;u>=0&&!c.charAt(u).match(_n);)l=c.charAt(u)+l,--u,--s.sentenceCursorOffset,--s.cursorOffset;var d=E(s.cursorOffset),_=E(s.cursorOffset+1),h=new q;h[fn]=e,h[gn]=s.sentenceCursorOffset,h[mn]=s.cursorOffset,h[vn]=d.left>_.left&&d.top<_.top+4,h[bn]="autocompletion";var p=((t[kt]||[])[0]||[]).beams||[],f=a.trimStart().length,g=[];if(p.length){var m=p[0],v=l+m[Rt].substr(f);if(v.trim().length){g.push({displayPostfix:v,postfix:v});var T=[a,m[Rt],t];e[mt].some(function(e){return e[0]===T[0]&&e[1]===T[1]})||e[mt].push(T)}}h[yn]=g,wn.update(r,h)}else ae(i,"canceled.",s,e)},function(e){o(),e===H.FAILURE_REASON__CANCELED||(Y(Ce,"autocompletion",e),console.error(e))})}())}),function(){var e="[ErrorHandling]",t=0;J(Se,function(e,n){t=Date.now()}),J(Ce,function(n,a){wn.close(),setTimeout(function(){wn.close()},150);try{if(ae(e,"ON__REQUEST_FAILED:",n,a),a.errorType===xt&&a.rpcError&&429===a.statusCode)if(ae(e,"Overload or blocking"),"autocomplete"===n||"alternatives"===n)Ue[Me](!0),Ue[Ie]=2*Date.now();else{Ue[Ie]=Date.now()+le;var i;try{var r=JSON.parse(a.rpcError.data.responseText).error;r&&1042901==r.code&&(i={id:"notification_user_blocked",severity:"critical",text:h("translator/notification_user_blocked","Due to too many requests from your browser, access to the free DeepL translator has been temporarily disabled. Please try again later."),priority:40,timeout_sec:60})}catch(e){console.error("Invalid server response.")}Wt.addNotification(i||{id:"notification_overload",severity:"critical",text:h("translator/notification_overload","Too much load. The functionality of DeepL Translator may be limited.")+" (err429)",priority:50,timeout_sec:60})}else a.errorType===xt&&a.rpcError&&456==a.statusCode?(Wt.addNotification(i||{id:"notification_quotaReached",severity:"critical",text:h("translator/proAccountError.quotaReached","Quota reached.")+"<div><a href='/subscription.html' class='dl_internal_link_row' target='_blank'>"+h("translator/proAccountError.accountPageButton","Go to your contract page")+"</a></div>",priority:90}),J(Ee,function(){return Wt.removeNotification("notification_quotaReached"),"REMOVE"})):a.errorType===xt&&a.rpcError&&403==a.statusCode?(Wt.addNotification(i||{id:"notification_accountProblem",severity:"critical",text:h("translator/proAccountError.accountProblem","Account problem.")+"<div><a href='/subscription.html' class='dl_internal_link_row' target='_blank'>"+h("translator/proAccountError.accountPageButton","Go to your contract page")+"</a></div>",priority:90}),J(Ee,function(){return Wt.removeNotification("notification_accountProblem"),"REMOVE"})):a.errorType===xt?(Ue[Ie]=Math.max(Ue[Ie],Date.now()+le),Wt.hasNotification("notification_networkProblems")||(Wt.addNotification({id:"notification_networkProblems",severity:"critical",text:h("translator/notification_networkProblems","There seems to be a problem with the internet connection. The functionality of DeepL Translator may be limited."),priority:100}),J(Ee,function(){if(Date.now()>t+2e4)return Wt.removeNotification("notification_networkProblems"),"REMOVE"}))):console.error("Unexpected error:",a)}catch(e){console.error(e)}}),Ue[qe].onValueChanged.push(function(e){e?Wt.addNotification({id:"notification_onlyOneSentence",severity:"normal",text:h("translator/notification_onlyOneSentence","<span>!</span> Due to high traffic on the free DeepL translator, the service is limited at the moment. You can only translate one sentence at a time and advanced editing functions are not available."),priority:30}):Wt.removeNotification("notification_onlyOneSentence")}),Ue[Me].onValueChanged.push(function(e){e?Wt.addNotification({id:"notification_noAdvancedEditing",severity:"normal",text:h("translator/notification_noAdvancedEditing","<span>!</span> Due to high traffic on the free DeepL translator, the service is limited at the moment and advanced editing functions are not available."),priority:20}):Wt.removeNotification("notification_noAdvancedEditing")}),J(be,function(){console.warn(be),Ue[qe](!0),Ue[Me](!0),Ue[Ie]=2*Date.now()})}(),K.CONFIG__HIGHLIGHT&&function(){function e(){o();var e=X.hasClass("lmt__textarea--iOSTextareaFix");X.addClass("lmt__textarea--inactive"),o.push(function(){X.removeClass("lmt__textarea--inactive")}),s=new Object(null),o.push(function(){s=void 0});var t=a("<div></div>").addClass("lmt__source_textarea_overlay").addClass("lmt__textarea_base_style").insertAfter(X);o.push(function(){t.remove()}),t.css(X.dlCSS("padding-top","padding-bottom","padding-left","padding-right","margin","overflow-x","overflow-y")).css("font",X.css("font")).css("line-height",X.css("line-height")).height(X.height()).innerWidth(X[0].getBoundingClientRect().width-(e?6:0)),e&&t.css("padding-left",parseInt(t.css("padding-left"))+3+"px");var n=Ve,r=[],l=parseInt(X.css("line-height"));n[He].forEach(function(e){e[it].length&&a("<span></span>").text(e[it]).appendTo(t);var n=e[ot],i=a("<span></span>").addClass("lmt__source_textarea_overlay__sentence_marker").css({height:l+"px"}).appendTo(t),o=a("<span></span>").addClass("lmt__source_textarea_overlay__text").text(n).appendTo(t),s=a("<span></span>").addClass("lmt__source_textarea_overlay__sentence_marker").css({height:l+"px"}).appendTo(t);r.push({sourceSentence:e,preNode:i,textNode:o,postNode:s}),e[rt].length&&a("<span></span>").text(e[rt]).appendTo(t)});var c=X.outerWidth()-parseInt(X.css("padding-right"));r.forEach(function(e){var n=[];s[e.sourceSentence[tt]]=n;var r=e.textNode.position(),o=e.textNode.height(),u=e.preNode.position(),d=e.postNode.position();if(n.push(e.textNode),i)if(o<1.5*l)n.push(a("<div></div>").addClass("lmt__source_textarea_overlay__sentence").css({top:r.top+"px",left:u.left+"px",height:l+"px",width:d.left-u.left+"px"}).appendTo(t));else{var _=r.top;n.push(a("<div></div>").addClass("lmt__source_textarea_overlay__sentence").css({top:_+"px",left:u.left+"px",height:l+"px",width:c-u.left+"px"}).appendTo(t)),_+=l,o>2.5*l&&(n.push(a("<div></div>").addClass("lmt__source_textarea_overlay__sentence").css({top:_+"px",left:r.left+"px",height:o-2*l+"px",width:c-r.left+"px"}).appendTo(t)),_+=o-2*l),n.push(a("<div></div>").addClass("lmt__source_textarea_overlay__sentence").css({top:_+"px",left:r.left+"px",height:l+"px",width:d.left-r.left+"px"}).appendTo(t))}else;})}function n(){var t=Ve;void 0===s&&(e(),l=void 0),b(t,Z.val());var n=w(),a=x(t,n),r=Z.prop("selectionEnd");if(!a||n!=r&&a.sentence!==x(t,r).sentence)o();else{var c=a.sentence;i&&ae("[highlight] targetSentence",c);var u=c.getSourceSentence();if(l!==u){if(X.parent().find(".lmt__source_textarea_overlay__sentence--active").removeClass("lmt__source_textarea_overlay__sentence--active"),u&&(!Ue[qe]()||u==t[He][0])){var d=s[u[tt]];d&&d.forEach(function(e){e.addClass("lmt__source_textarea_overlay__sentence--active")})}l=u}}}var i=!1,o=t.createCallOnce(),s=void 0;r._markSourceSentences=e,J(Le,o),X.on("focus click keydown",o),Z.on("blur",o),a(window).on("resize",o);var l;document.addEventListener("selectionchange",function(){var e=window.getSelection();e.anchorNode!==Z[0]&&e.anchorNode!==Z.parent()[0]||e.focusNode!==e.anchorNode||n()}),Z.on("keyup click",function(){n()}),t.addCSSNode(".lmt__source_textarea_overlay{position: absolute;pointer-events: none;top: 0;left: 0;}.lmt__source_textarea_overlay * {pointer-events: none;}.lmt__source_textarea_overlay__sentence{ visibility: hidden; position: absolute;background: rgba(250, 166, 10, 0.1);}.lmt__source_textarea_overlay__sentence--active{ visibility: visible !important; }.lmt__source_textarea_overlay__text{ visibility: hidden; background-color: white; }.lmt__source_textarea_overlay__sentence_marker{display: inline;position: absolute;width: 0px;}")}(),function(){var e,t;J(Le,function(){function n(){t=!0,(e||(e=a(".lmt__source_textarea__length_marker_pro_advertisement"),J(Re,function(){e.removeClass("lmt__source_textarea__length_marker_pro_advertisement--visible").detach(),t=!1})),e).css("display","block").appendTo(X.parent()),setTimeout(function(){e.addClass("lmt__source_textarea__length_marker_pro_advertisement--visible")},100)}var i=X.parent().find(".lmt__source_textarea__length_marker"),r=X.val().length;(r>de||i.length)&&(i.length||(i=a("<div class='lmt__source_textarea__length_marker'></div>").appendTo(X.parent())),i.text(G?r:r+"/"+ue),r>ue?(X.closest(".lmt__textarea_container").addClass("lmt__textarea_container--text_too_long"),i.addClass("lmt__source_textarea__length_marker--critical")):(X.closest(".lmt__textarea_container").removeClass("lmt__textarea_container--text_too_long"),i.removeClass("lmt__source_textarea__length_marker--critical"))),r>4e3&&!G&&(t||n())})}(),!dl.isMobilePhone&&function(){function e(){var e=Z.offset(),t=Z.outerWidth(),i=Z.outerHeight(),r=e.left+t,s=Math.max(a(window).width()-15,r)-e.left-n.width()/2;e.top+=i-10,e.left+=Math.min(t/2,s),n.position(e,"top"),o.hasClass("lmt__translator--showing_alternatives")&&n.hide()}function t(){var e=X.val();return 0==a(".lmt__language_select.lmt__language_select--open").length&&!Ue[Me]()&&e.length>50&&Z.val().length>0&&null!=e.match(/[.!?:]\s*$/)&&!wn.isOpen()&&!o.hasClass("lmt__translator--showing_alternatives")&&0==a(".lmt__edit_text_popup--initial_alternatives").length}var n=$t.create("clickHint",h("translator/messageBox_clickHint","Click on a word to get alternative formulations."));n.maximalDisplayCount(10),window._updateTranslationMessageBox=e,J(ve,function(){n.hide(250)}),J(Te,function(a){n.isHidden()&&t()?(e(),n.show(250,5e3,null,t)):n.hide()}),J(De,function(){e(),setTimeout(e,300)}),J(ke,function(e){e[yn]&&e[yn].length>1&&"alternatives"==e[bn]&&n.disable(!0)}),J("ON__LANGUAGE_SELECT_OPENED",function(){n.hide(250)})}();var Ln=a(".lmt__language_select--source"),Rn=a(".lmt__language_select--target");Rn.change(".lmt__language_select--target",function(e,n,i){var r=a(this).attr("dl-value");Qe.setSelectedTargetLang(r),ae("User has changed target language: old="+i+", new="+r+", sourceLang="+Qe.selectedSourceLang),Qe.pushPreferredLang(r),F(Rn,r),_.reset(),ae("target lang change "+i+" --\x3e "+n+" (selected source: "+Qe.selectedSourceLang+")"),Y(Le,new R(Ve,oe)),setTimeout(function(){t.notify("LMT/langChanged")},100)}),Ln.change(".lmt__language_select--source",function(e,n){ae("User has changed source language.");var i="auto"!=Qe.selectedSourceLang?Qe.selectedSourceLang:Qe.sourceLang;Qe.selectedSourceLang=a(this).attr("dl-value"),"auto"!=Qe.selectedSourceLang&&Qe.pushPreferredLang(Qe.selectedSourceLang),_.reset(),F(Ln,Qe.selectedSourceLang),"auto"!=Qe.selectedSourceLang&&Qe.selectedSourceLang==Qe.getSelectedTargetLang()&&(ae("Switching target language, too. lastSourceLang="+i+", ui.selectedSourceLang="+Qe.selectedSourceLang),Qe.setSelectedTargetLang("auto"!=i&&i!=Qe.selectedSourceLang?i:"EN"),F(Rn,Qe.getSelectedTargetLang())),Y(Le,new R(Ve,re)),setTimeout(function(){t.notify("LMT/langChanged")},100)}),$(Ln),$(Rn),J("ON__LANGUAGE_CHANGED",function(e,t){Qe.sourceLang=e,Qe.targetLang=t,F(Ln,Qe.sourceLang),F(Rn,Qe.targetLang),ae("updateDisplayedLanguages: source: "+Qe.sourceLang+", target: "+Qe.targetLang+", selectedSourceLang="+Qe.selectedSourceLang)}),J(Le,function(e){"auto"==Qe.selectedSourceLang&&""!=Qe.sourceLang&&0==X.val().trim().length&&F(Ln,"auto")}),a(".lmt__language_select").click(function(e){var t=a(this);if(0==a(e.target).closest("ul").length){var n=t.hasClass("lmt__language_select--open");a(".lmt__language_select").removeClass("lmt__language_select--open").removeClass("lmt__language_select--open_2"),n?o.removeClass("lmt__translator--with_open_language_menu"):(t.addClass("lmt__language_select--open"),setTimeout(function(){t.addClass("lmt__language_select--open_2")}),o.addClass("lmt__translator--with_open_language_menu"),Y("ON__LANGUAGE_SELECT_OPENED"))}}),a(".lmt__language_select li").click(function(){var e=a(this),t=e.closest(".lmt__language_select"),n=t.find("label strong"),i=e.attr("dl-value"),r=t.attr("dl-value"),s=t.attr("dl-displayed");i===r&&i===s||(n.html(e.html()),void 0===i?t.removeAttr("dl-value"):t.attr("dl-value",i),t.trigger("change",[i,r])),t.removeClass("lmt__language_select--open_2"),setTimeout(function(){t.removeClass("lmt__language_select--open"),o.removeClass("lmt__translator--with_open_language_menu")},150)}),a(".lmt__language_select").change(".lmt__language_select",function(e,t){}),J(fe,function(e,t){0==e.closest(".lmt__language_select").length&&(a(".lmt__language_select").removeClass("lmt__language_select--open").removeClass("lmt__language_select--open_2"),o.removeClass("lmt__translator--with_open_language_menu"))}),function(){function e(e){var t;try{t=document.execCommand("insertText",!1,e)}catch(e){console.warn("[insertTextIntoActiveTextarea]",e)}if(!t){var n=document.activeElement;if(ae("[insertTextIntoActiveTextarea]",n),!n||"textarea"!=n.tagName.toLowerCase())return console.warn("[insertTextIntoActiveTextarea]",n),!1;var i=n.selectionStart,r=n.selectionEnd,o=a(n).val();a(n).val(o.substr(0,i)+e+o.substr(r)),n.setSelectionRange(i+e.length,i+e.length)}return!0}G&&J("ON__INTERCEPT_PASTED_TEXT",function(t,n,i,r){function o(){g.removeAttr("disabled"),d.removeClass("lmt__ask_paste_popup--visible_2"),d.removeClass("lmt__ask_paste_popup--visible"),_.text(" "),h.off("click"),p.off("click")}var s=n();if(t.is(".lmt__source_textarea")&&s.length>5e4){var l=document.activeElement,c=l.selectionStart,u=l.selectionEnd,d=a(".lmt__ask_paste_popup"),_=d.find("> div > p"),h=d.find(".lmt__ask_paste_popup__cancel_button"),p=d.find(".lmt__ask_paste_popup__continue_button"),f=_.attr("dl-text-template"),g=a(".lmt__source_textarea, .lmt__clear_text_button, .lmt__target_textarea");g.attr("disabled","true"),h.on("click",o),p.on("click",function(){setTimeout(function(){a(".lmt__source_textarea")[0].select(),a(".lmt__source_textarea")[0].setSelectionRange(c,u),e(s),Kt()}),o()}),l.blur(),h.select(),_.text(f.replace("%%num%%",s.length)),d.addClass("lmt__ask_paste_popup--visible"),setTimeout(function(){d.addClass("lmt__ask_paste_popup--visible_2")},100),n(!1)}}),[X,Z].forEach(function(n){n.on("paste",function(a){ae("[paste]..");var i=a.originalEvent,r=i.clipboardData||window.clipboardData||"",o=r.getData("Text").trim().replace(/\r/g,""),s=t.createValueWrapper(o);if(Y("ON__INTERCEPT_PASTED_TEXT",n,s,r,i),!1===s())i.preventDefault();else if(o!==s()){if(ae("[paste] Text has been altered: ",s()),e(s()))return L(a);console.warn("[paste] Could not insert altered text.")}})}),Z.on("copy",function(e){var n=e.originalEvent,a=""+window.getSelection();if(0===a.length){var i=Z[0].selectionStart,r=Z[0].selectionEnd;a=Z.val().substr(i,r-i)}var o=t.createValueWrapper(a);Y(ye,o),a!==o()&&(n&&n.clipboardData&&n.clipboardData.setData?(n.clipboardData.setData("text/plain",o()),n.preventDefault()):ae("Clipboard could not be updated."))})}(),J("ON__INTERCEPT_PASTED_TEXT",function(e,t,n,a){var i=n&&n.types||"";if(i instanceof DOMStringList&&i.contains("text/html")||i.indexOf&&-1!==i.indexOf("text/html")){var r=n.getData("text/html");!r||-1==r.indexOf('<br class="wide"')&&-1==r.indexOf('<br class="narrow"')||(t(t().replace(/(\S) *\n *(\S)/g,"$1 $2")),ae("Fix special line breaks"))}});var kn={DE:"Übersetzt mit www.DeepL.com/Translator",EN:"Translated with www.DeepL.com/Translator",ES:"Traducción realizada con el traductor www.DeepL.com/Translator",FR:"Traduit avec www.DeepL.com/Translator",IT:"Tradotto con www.DeepL.com/Translator",NL:"Vertaald met www.DeepL.com/Translator",PL:"Przetłumaczono przy pomocy www.DeepL.com/Translator",RU:"Переведено с помощью www.DeepL.com/Translator"};K.CONFIG__ADD_TRANSLATION_FOOTER&&!dl.isIPad&&function(){function e(){var e=B.getValue("LMT_copyEvents");return Array.isArray(e)?e:[]}function t(){var t=0,n=Date.now()-864e5;return e().forEach(function(e){e>n&&++t}),t}var n=kn,a=3;J(ye,function(i){var r=i();if(!(r.length<400)){for(var o in n)if(r.search(n[o])>=0)return;ae("[TranslationFooter] Events: ",t(),"length",r.length),t()>=a?ae("[TranslationFooter] Don't add footer."):(ae("[TranslationFooter] Add footer."),i(r+"\n\n"+(n[Ve[Ge]]||n.EN))),function(){var t=e();t.push(Date.now()),t.splice(0,t.length-a),B.setValue("LMT_copyEvents",t)}()}}),J("ON__INTERCEPT_PASTED_TEXT",function(e,t,a,i){var r=t();if(r)for(var o in n){var s=n[o];if(r.endsWith(s)&&r.length>=400+s.length){t(r.substr(0,r.length-s.length));break}}})}(),J(me,function(e,t){var n=!1;e.numNotCachedBatchesToTranslate()>1&&(n&&ae("<<<<<<<"),t.onRequestEnded.push(function(){n&&console.log(">>>>>>>>>>")}),e.currentBatchId.onValueChanged.push(function(i){function r(){var t=e.numRemainingCharacters();n&&console.log("------- : ",t),l.text(d.replace("%%num%%",_-t).replace("%%total%%",_)),c.css("width",100-t/_*100+"%")}function o(){h.removeAttr("disabled"),s.removeClass("lmt__progress_popup--visible_2"),s.removeClass("lmt__progress_popup--visible"),s.removeClass("lmt__progress_popup--stopping"),c.css("width","0%"),l.text(" "),u.off("click")}if(1===i){var s=a(".lmt__progress_popup"),l=s.find("> div > p"),c=s.find(".lmt__progress_popup__progress div"),u=s.find(".lmt__progress_popup__stop_button"),d=l.attr("dl-text-template"),_=e.numCharactersToTranslate()||1,h=a(".lmt__source_textarea, .lmt__clear_text_button, .lmt__target_textarea");u.on("click",function(){e.stopped(!0),s.addClass("lmt__progress_popup--stopping")}),h.attr("disabled","true"),r(),s.addClass("lmt__progress_popup--visible"),setTimeout(function(){s.addClass("lmt__progress_popup--visible_2")},100),e.finished.onValueChanged.push(function(e){e&&o()}),e.numRemainingCharacters.onValueChanged.push(r),t.onRequestEnded.push(o)}}))}),G&&e.connectTo({url:"/PHP/backend/stripe/account.php?request_type=jsonrpc&il="+kDeepL.getDocumentLanguage(),method:"POST",withCredentials:!0}).getFunction("hasActiveSubscription")().then(function(e){if(e){a("html").addClass("with_subscription");var n=h("translator/usingProHint.text_1","You are using DeepL Pro; your texts are never stored.")+" "+h("translator/usingProHint.text_2","");t.addCSSNode("pro_text",'.dl_user_logged_in .lmt__side_container--source div.lmt__textarea_container::after {content: "'+n+'" !important;}')}else a("html").addClass("without_subscription"),a(".lmt__source_textarea, .lmt__clear_text_button, .lmt__target_textarea").attr("disabled","true"),Wt.addNotification({id:"proAccountError.noSubscription",severity:"final",text:h("translator/proAccountError.noSubscription","Account problem.")+"<div><a href='/subscription.html' class='dl_internal_link_row'>"+h("translator/proAccountError.accountPageButton","Go to your contract page")+"</a></div><div><a href='#' class='dl_internal_link_row' onclick='kDeepL.logout(undefined,\"/translator\")'>"+h("translator/proAccountError.logoutAndUseFreeButton","Log out")+"</a></div>",priority:100})});var On=function(){function e(){J(Le,function(t){return i.addClass("lmt__target_toolbar--visible"),J(Re,function(){return i.removeClass("lmt__target_toolbar--visible"),e(),"REMOVE"}),"REMOVE"})}var n=Z.closest(".lmt__textarea_container"),i=a('<div class="lmt__target_toolbar"></div>').appendTo(n);t.createCallOnce();return setTimeout(function(){jt.initTooltips(i)}),e(),{$toolbar:i}}();return function(){var e=a("<div title='Copy to clipboard' class='lmt__target_toolbar__copy'></div>"),t=a("<button></button>").appendTo(e);t.click(function(){u(Z).then(function(){Ht.show({target:t,content:h("translator/copyText.feedback","Text has been copied"),timeout:1e3})},function(){console.warn("Could no write to clipboard.")})}),On&&e.appendTo(On.$toolbar)}(),!dl.isIPad&&function(){function e(e){return new Promise(function(n,a){M.requireAsync(["FileSaver_saveAs"],function(a){var i=Z.val(),r=e;if(!r){r="DeepL_"+Ve[$e]+"-"+Ve[Ge]+"_";var o=Ve[je][0];if(o){var s=o[ut];if(s.length>32){var l=s.indexOf(" ",24);s=l>0&&l<=32?s.substr(0,l)+" …":s.substr(0,32)+"…"}(s=s.trim().replace(/[~"#%&*:<>?/\\{|}.]/g,"_")).length&&(r+="("+s+")")}r+=".txt"}i.trim().length&&!G&&(i+="\n\n"+(kn[Ve[Ge]]||kn.EN)),(navigator.platform||"").toLowerCase().indexOf("win")>=0&&(ae(t,"Use windows line breaks."),i=i.replace(/\n/g,"\r\n")),ae(t,"Save text as ",r),a(new Blob([i],{type:"text/plain;charset=utf-8"}),r),n(r)})})}var t="[FileSave]";window._download=e;var n=a("<div title='"+h("translator/saveText.tooltip","Save as text file")+"' class='lmt__target_toolbar__save'></div>"),i=a("<button></button>").appendTo(n);i.click(function(){rn()?Ht.show({target:i,content:h("translator/toolbar.waitForRequestsFeedback","Please wait for all requests to finish"),timeout:1e3,class:"lmt__feedback_message--warn"}):e(void 0).then(function(e){Ht.show({target:i,content:h("translator/saveText.successFeedback","Text file created"),timeout:1e3})},function(e){console.error(e)})}),On&&n.appendTo(On.$toolbar)}(),function(){function e(){if(ae(m,"update canonical"),dl.isIPad||dl.isIPhone){var e=(a('head link[rel="canonical"]').attr("href")||"").split("#")[0],t=location.href.split("#")[1].replace(/\./g,"%2e");a('head link[rel="canonical"]').attr("href",t?e+"#"+t:e)}else a('head link[rel="canonical"]').remove()}function n(){var t=location.href;t.search("#")>=0&&window.history.pushState(null,"",t.split("#",2)[0]),e()}function i(n){ae(m,"apply url",n);var i=n.split("#",2)[1];if(i){e();var r=function(e){return decodeURIComponent(e).replace(/[\\]./g,function(e){return"\\\\"===e?"{_BACKSLASH_}":e}).replace(/([^\\])[/]/g,"$1{_DELIM_1_}").replace(/([^\\])[|]/g,"$1{_DELIM_2_}").replace(/\\([/|])/g,"$1").replace(/{_BACKSLASH_}/g,"\\")}(i);v&&ae("decodedText",r);for(var o=r.split("{_DELIM_1_}"),s=(o.shift()||"").toUpperCase(),l=(o.shift()||"").toUpperCase(),u="",p="",g=!1,T=[];o.length;){var y=o.shift().split("{_DELIM_2_}",2);v&&ae(m,"s_t_sentences:",y),u+=y[0];var b=y[1]||"";p+=b,g|=b.length>0,T.push(b)}if(2==s.length&&2==l.length&&u.length)if(N(X,""),Z.val(""),Kt(),Ve[$e]==s&&Ve[Ge]==l||(ae(m,"Switching lang because of url"),_.switchLangCodes(s,l),Qe.setSelectedTargetLang(l)),g){v&&ae(m,"Setting target sentence texts..."),Z.val(p);(w=new R(Ve,se))[tn]=!0,w.sourceLangHasBeenDetermined=!0,w[en].push(function(){var e=w[Jt];ae(m,"Source sentences updated; Setting target sentences...."),ae(m,e[je]),e[je].splice(0),T.forEach(function(t,n){var a=new f(t);a[vt]=d(),e[je].push(a)}),function(){var e=t.createCallOnce(),n=a("<div class='lmt__altered_shared_text_hint'></div>").append(a("<p>"+h("translator/share.editedTranslationHint","The translation has been edited.")+"</p>")).append(a("<div class='lmt__altered_shared_text_hint__buttons'></div>").append(a("<button>"+h("translator/share.editedTranslation_revertButton","Change back to the original version")+"</button>").click(function(){c(),e()})).append(a("<button>"+h("translator/share.editedTranslation_acceptButton","Accept changes")+"</button>").click(e))).appendTo(a(".lmt__side_container--target .lmt__textarea_container")),i=a("<div class='lmt__mobile_altered_shared_text_hint'></div>").append(a("<p>"+h("translator/share.editedTranslationHint","The translation has been edited.")+"</p>")).append(a("<div class='lmt__mobile_altered_shared_text_hint__buttons'></div>").append(a("<button>"+h("translator/share.editedTranslation_revertButton","Change back to the original version")+"</button>").click(function(){c(),e()})).append(a("<button>"+h("translator/share.editedTranslation_acceptButton","Accept changes")+"</button>").click(e))).insertAfter(a(".lmt__translations_as_text"));e.push(function(){n.css("opacity","0"),i.css("opacity","0"),setTimeout(function(){n.remove(),i.remove()},400)}),setTimeout(function(){J(Ne,function(){return ae(m,"removeHint 1"),e(),"REMOVE"}),J(Le,function(){return ae(m,"removeHint 2"),e(),"REMOVE"})})}()}),v&&ae(m,"Setting source text:",u),zt(w,u),nn("update")}else{v&&ae(m,"Setting source text:",u);var w=new R(Ve,se);w.sourceLangHasBeenDetermined=!0,zt(w,u)}}}function r(e){return encodeURIComponent(e.replace(/([\\|/])/g,"\\$1"))}function o(e,t){var n=location.href.split("#",2)[0],a=[],i=n.length,o=!1,s="";return t?e[He].some(function(t,n){var l=r(t.getText());if(i+l.length>T)return o=!0,!0;var c=e[je][n],u=c&&r(c.getText())||"[...]";return i+u.length>T?(o=!0,!0):(s+=c&&c.getText()||"[...]",i+=l.length+u.length+2,a.push(l+encodeURIComponent("|")+u),!1)}):e[He].some(function(t,n){var l=r(t.getText());if(i+l.length>T)return o=!0,!0;var c=e[je][n];return s+=c&&c.getText()||"[...]",i+=l.length,a.push(l),!1}),a.length&&(n+="#"+e[$e].toLowerCase()+"/"+e[Ge].toLowerCase()+"/"+(t?a.join("/"):a.join(""))),[n,o,s]}function l(e){var t=!1;return e[je].forEach(function(e){var n=e.getTranslation();n&&(t|=e.getText().trim()!=(n[Je]||"").trim())}),t}function c(){if(rn())ae(m,"Delayed revert..."),rn.onValueChanged.push(function(){return setTimeout(c,100),"REMOVE"});else{ae(m,"Revert!");var e="";Ve[je].forEach(function(t){var n=t.getTranslation();n?(s=t.getWhitespacesBefore()+n[Je]+t.getWhitespacesAfter(),t.setText(s)):s=t.getText(),e+=s}),ae(m,"Reverted text ["+e+"]"),A(e),a(".lmt__translations_as_text__main_translation").text(e),p()}}function p(){if(v&&ae(m,"Refresh URL..."),G||X.val().length>T)n();else{if(l(Ve))n();else{var t=o(Ve,!1);if(t[1])n();else{var a=t[0].replace(/%20/g," ");window.history.replaceState(null,"",a),e(),v&&ae(m,"Update URL",a)}}}}function g(){rn()||on()?x.addClass("lmt__mobile_share_container--inactive"):x.removeClass("lmt__mobile_share_container--inactive")}var m="[Share]",v=!0,T=1900;window._createTextUrl=function(e){return o(Ve,e)},window.onhashchange=function(){console.log("window.onhashchange",location.href),i(location.href)},i(location.href),J(Le,function(e){v&&ae(m,"CHANGED (0)"),j("share_refresh",p,500)}),J("ON__SOURCE_SENTENCES_CHANGED",function(e){v&&ae(m,"CHANGED (1)"),j("share_refresh",p,500)}),J(Ne,function(e){v&&ae(m,"CHANGED (2)"),j("share_refresh",p,500)});var y=t.createCallOnce(),b=a("<div class='lmt__target_toolbar__share'></div>"),w=a("<button title='"+h("translator/share.tooltip","Share translation")+"'></button>").appendTo(b);w.click(function(){M.requireAsync(["Shariff"],function(e){if(b.hasClass("lmt__target_toolbar__share--open"))y();else{if(rn())return void Ht.show({target:w,content:h("translator/toolbar.waitForRequestsFeedback","Please wait for all requests to finish."),timeout:1e3,class:"lmt__feedback_message--warn"});var t=o(Ve,l(Ve)),n=t[0];v&&ae(m,"Open share menu. URL: ",n,n.length,t[1]);var i=a("<div><h2>"+h("translator/shareMenu.headline","Share")+"</h2><label>"+h("translator/shareMenu.urlToShare","URL to share")+"</label><input type='text' /><div class='lmt__target_toolbar__copy_link'><button>"+h("translator/shareMenu.copyUrlButton","copy URL")+"</button></div></div>");t[1]&&i.append("<div class='lmt__target_toolbar__share_shortened_hint'>"+h("translator/shareMenu.textShortendHint","Note: Only short texts can be shared directly. Only the first sentences will be included.")+"</div>"),i.append("<div class='lmt__target_toolbar__share_buttons'></div>").appendTo(b),i.find(".lmt__target_toolbar__copy_link button").click(function(){u(i.find("input"))}),i.find("input").on("click",function(){a(this).focus().get(0).select()}).val(n),new e(i.find(".lmt__target_toolbar__share_buttons"),{backendUrl:null,lang:kDeepL.getDocumentLanguage().toLowerCase().substr(0,2),mailBody:t[2]+"\n \n "+h("translator/share.mailBody","Translated with www.DeepL.com/translator")+"\n {url}",mailSubject:h("translator/share.mailSubject","Translation via DeepL Translator"),mailUrl:"mailto:",title:t[2]+"\n",theme:"normal",url:n,orientation:"horizontal",services:["twitter","facebook","mail"]}),setTimeout(function(){b.addClass("lmt__target_toolbar__share--open")}),y.push(function(){i.remove(),b.removeClass("lmt__target_toolbar__share--open")}),jt.initTooltips(i)}})}),J(ge,function(e){e.closest(".lmt__target_toolbar__share,.lmt__mobile_share_container").length||y()}),J(fe,function(e){e.closest(".lmt__target_toolbar__share,.lmt__mobile_share_container button,.lmt__mobile_share_container > div").length||y()}),On&&b.appendTo(On.$toolbar);var x=a("<div class='lmt__mobile_share_container lmt__mobile_share_container--inactive'></div>").appendTo(a(".lmt__sides_container")),C=a("<button title='"+h("translator/share.tooltip","Share translation")+"'></button>").appendTo(x);rn.onValueChanged.push(g),on.onValueChanged.push(g),C.click(function(){if(navigator.share){if(rn()||on())return;ae&&ae(m,"Use share api");var e=o(Ve,l(Ve));navigator.share({title:h("translator/share.mailSubject","Translation via DeepL Translator"),text:e[2],url:e[0]})}else M.requireAsync(["Shariff"],function(e){if(x.hasClass("lmt__mobile_share_container--open"))y();else{if(rn()||on())return;var t=o(Ve,l(Ve)),n=t[0];v&&ae(m,"Open mobile share menu. URL: ",n,n.length,t[1]);var i=a("<div><h2>"+h("translator/shareMenu.headline","Share")+"</h2></div>");t[1]&&i.append("<div class='lmt__target_toolbar__share_shortened_hint'>"+h("translator/shareMenu.textShortendHint","Note: Only short texts can be shared directly. Only the first sentences will be included.")+"</div>");var r=a("<div class='lmt__mobile_share_container__share_buttons'></div>").appendTo(i);i.appendTo(x),new e(r,{backendUrl:null,lang:kDeepL.getDocumentLanguage().toLowerCase().substr(0,2),mailBody:t[2]+"\n \n "+h("translator/share.mailBody","Translated with www.DeepL.com/translator")+"\n {url}",mailSubject:h("translator/share.mailSubject","Translation via DeepL Translator"),mailUrl:"mailto:",title:t[2]+"\n",theme:"normal",url:n,orientation:"horizontal",services:["twitter","facebook","whatsapp","mail"]}),setTimeout(function(){x.addClass("lmt__mobile_share_container--open")}),y.push(function(){ae(m,"closing menu"),i.remove(),x.removeClass("lmt__mobile_share_container--open")})}})}),a(".lmt__mobile_share_container").click(function(){x.hasClass("lmt__mobile_share_container--open")&&y()})}(),document.body.requestFullscreen&&document.body.requestFullscreen(),r}}});
//# sourceMappingURL=translator_late.map